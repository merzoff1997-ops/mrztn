<!DOCTYPE html>

<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Party Games Elite - –ü—Ä–µ–º–∏—É–º –∏–≥—Ä—ã –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏</title>
    <style>
        /* ===== –ì–õ–û–ë–ê–õ–¨–ù–´–ï CSS –ü–ï–†–ï–ú–ï–ù–ù–´–ï ===== */
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #13131a;
            --bg-tertiary: #1a1a24;
            --bg-glass: rgba(26, 26, 36, 0.7);
            --accent: #7c3aed;
            --accent-hover: #9333ea;
            --accent-glow: rgba(124, 58, 237, 0.3);
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: rgba(148, 163, 184, 0.1);
            --shadow: rgba(0, 0, 0, 0.5);
            --gradient: linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 100%);
        }

```
    /* ===== –¶–í–ï–¢–û–í–´–ï –¢–ï–ú–´ ===== */
    [data-theme="dark"] {
        --accent: #7c3aed;
        --accent-hover: #9333ea;
        --accent-glow: rgba(124, 58, 237, 0.3);
    }

    [data-theme="discord"] {
        --accent: #5865f2;
        --accent-hover: #4752c4;
        --accent-glow: rgba(88, 101, 242, 0.3);
    }

    [data-theme="twitter"] {
        --accent: #1d9bf0;
        --accent-hover: #1a8cd8;
        --accent-glow: rgba(29, 155, 240, 0.3);
    }

    [data-theme="emerald"] {
        --accent: #10b981;
        --accent-hover: #059669;
        --accent-glow: rgba(16, 185, 129, 0.3);
    }

    [data-theme="red"] {
        --accent: #ef4444;
        --accent-hover: #dc2626;
        --accent-glow: rgba(239, 68, 68, 0.3);
    }

    [data-theme="light"] {
        --bg-primary: #f8fafc;
        --bg-secondary: #ffffff;
        --bg-tertiary: #f1f5f9;
        --bg-glass: rgba(255, 255, 255, 0.7);
        --text-primary: #0f172a;
        --text-secondary: #475569;
        --text-muted: #94a3b8;
        --border: rgba(15, 23, 42, 0.1);
        --shadow: rgba(0, 0, 0, 0.1);
    }

    /* ===== –°–ë–†–û–° –ò –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò ===== */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        overflow-x: hidden;
        position: relative;
        min-height: 100vh;
        transition: background 0.3s ease, color 0.3s ease;
    }

    /* ===== –ñ–ò–í–û–ô –ê–ù–ò–ú–ò–†–û–í–ê–ù–ù–´–ô –§–û–ù ===== */
    .animated-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        overflow: hidden;
        pointer-events: none;
    }

    .bg-orb {
        position: absolute;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.15;
        animation: float-orb 20s infinite ease-in-out;
    }

    .bg-orb:nth-child(1) {
        width: 400px;
        height: 400px;
        background: var(--accent);
        top: -200px;
        left: -200px;
        animation-delay: 0s;
    }

    .bg-orb:nth-child(2) {
        width: 500px;
        height: 500px;
        background: var(--accent-hover);
        bottom: -250px;
        right: -250px;
        animation-delay: 5s;
    }

    .bg-orb:nth-child(3) {
        width: 300px;
        height: 300px;
        background: var(--accent);
        top: 50%;
        left: 50%;
        animation-delay: 10s;
    }

    @keyframes float-orb {
        0%, 100% { transform: translate(0, 0) scale(1); }
        33% { transform: translate(50px, -50px) scale(1.1); }
        66% { transform: translate(-50px, 50px) scale(0.9); }
    }

    /* ===== CONTAINER ===== */
    .container {
        position: relative;
        z-index: 1;
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    /* ===== LOADING SCREEN ===== */
    .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--bg-primary);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        transition: opacity 0.5s, visibility 0.5s;
    }

    .loading-screen.hidden {
        opacity: 0;
        visibility: hidden;
    }

    .loader-ring {
        width: 80px;
        height: 80px;
        border: 4px solid transparent;
        border-top: 4px solid var(--accent);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .loading-text {
        margin-top: 20px;
        font-size: 1.2rem;
        color: var(--text-secondary);
        animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    /* ===== HEADER ===== */
    .header {
        position: sticky;
        top: 0;
        z-index: 100;
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border);
        padding: 15px 0;
        animation: slideDown 0.5s ease;
    }

    @keyframes slideDown {
        from { transform: translateY(-100%); }
        to { transform: translateY(0); }
    }

    .header-content {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 20px;
    }

    .logo {
        font-size: 1.8rem;
        font-weight: 800;
        background: var(--gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        cursor: pointer;
        transition: transform 0.3s ease;
    }

    .logo:hover {
        transform: scale(1.05);
    }

    .header-controls {
        display: flex;
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
    }

    .user-info {
        display: flex;
        align-items: center;
        gap: 10px;
        background: var(--bg-tertiary);
        padding: 8px 16px;
        border-radius: 50px;
        border: 1px solid var(--border);
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .user-info:hover {
        background: var(--bg-secondary);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px var(--shadow);
    }

    .user-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: var(--gradient);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }

    .user-name {
        font-weight: 600;
        color: var(--text-primary);
    }

    /* ===== BUTTONS ===== */
    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 12px;
        background: var(--gradient);
        color: white;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px var(--accent-glow);
        position: relative;
        overflow: hidden;
    }

    .btn::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
    }

    .btn:hover::before {
        width: 300px;
        height: 300px;
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px var(--accent-glow);
    }

    .btn:active {
        transform: translateY(0);
    }

    .btn-secondary {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border: 1px solid var(--border);
        box-shadow: none;
    }

    .btn-secondary:hover {
        background: var(--bg-secondary);
        box-shadow: 0 4px 15px var(--shadow);
    }

    .btn-icon {
        width: 45px;
        height: 45px;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
        border-radius: 12px;
    }

    /* ===== THEME SELECTOR ===== */
    .theme-selector {
        display: flex;
        gap: 8px;
        background: var(--bg-tertiary);
        padding: 8px;
        border-radius: 12px;
        border: 1px solid var(--border);
    }

    .theme-option {
        width: 35px;
        height: 35px;
        border-radius: 8px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.3s ease;
        position: relative;
    }

    .theme-option::after {
        content: '‚úì';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-weight: bold;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .theme-option.active::after {
        opacity: 1;
    }

    .theme-option:hover {
        transform: scale(1.1);
        border-color: rgba(255, 255, 255, 0.3);
    }

    .theme-dark { background: linear-gradient(135deg, #7c3aed, #9333ea); }
    .theme-discord { background: linear-gradient(135deg, #5865f2, #4752c4); }
    .theme-twitter { background: linear-gradient(135deg, #1d9bf0, #1a8cd8); }
    .theme-emerald { background: linear-gradient(135deg, #10b981, #059669); }
    .theme-red { background: linear-gradient(135deg, #ef4444, #dc2626); }
    .theme-light { background: linear-gradient(135deg, #f1f5f9, #cbd5e1); }

    /* ===== GLASS CARD ===== */
    .glass-card {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 8px 32px var(--shadow);
        transition: all 0.3s ease;
    }

    .glass-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px var(--shadow);
    }

    /* ===== SCREENS ===== */
    .screen {
        display: none;
        animation: fadeInUp 0.5s ease;
    }

    .screen.active {
        display: block;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* ===== REGISTRATION SCREEN ===== */
    .registration-screen {
        max-width: 500px;
        margin: 100px auto;
    }

    .reg-form {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .form-label {
        font-weight: 600;
        color: var(--text-secondary);
    }

    .form-input {
        padding: 15px;
        background: var(--bg-tertiary);
        border: 2px solid var(--border);
        border-radius: 12px;
        color: var(--text-primary);
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .form-input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 4px var(--accent-glow);
    }

    .avatar-selector {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
        gap: 10px;
    }

    .avatar-option {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        background: var(--gradient);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        cursor: pointer;
        border: 3px solid transparent;
        transition: all 0.3s ease;
    }

    .avatar-option:hover {
        transform: scale(1.1);
    }

    .avatar-option.selected {
        border-color: var(--accent);
        box-shadow: 0 0 20px var(--accent-glow);
    }

    /* ===== GAMES MENU ===== */
    .games-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 25px;
        margin-top: 30px;
    }

    .game-card {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 30px;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .game-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: var(--gradient);
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }

    .game-card:hover::before {
        transform: scaleX(1);
    }

    .game-card:hover {
        transform: translateY(-8px);
        border-color: var(--accent);
        box-shadow: 0 15px 40px var(--accent-glow);
    }

    .game-icon {
        font-size: 3.5rem;
        margin-bottom: 15px;
        filter: drop-shadow(0 0 10px var(--accent-glow));
    }

    .game-title {
        font-size: 1.6rem;
        font-weight: 700;
        margin-bottom: 10px;
        color: var(--text-primary);
    }

    .game-desc {
        color: var(--text-secondary);
        font-size: 0.95rem;
        line-height: 1.5;
    }

    /* ===== GAME HEADER ===== */
    .game-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--border);
    }

    .game-header-title {
        font-size: 2.5rem;
        font-weight: 800;
        background: var(--gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    /* ===== TIC TAC TOE ===== */
    .ttt-board {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        max-width: 450px;
        margin: 30px auto;
    }

    .ttt-cell {
        aspect-ratio: 1;
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 2px solid var(--border);
        border-radius: 16px;
        font-size: 4rem;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .ttt-cell::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: var(--accent-glow);
        transform: translate(-50%, -50%);
        transition: width 0.3s, height 0.3s;
    }

    .ttt-cell:hover:not(.filled)::before {
        width: 100%;
        height: 100%;
    }

    .ttt-cell:hover:not(.filled) {
        border-color: var(--accent);
        transform: scale(1.05);
    }

    .ttt-cell.filled {
        cursor: not-allowed;
    }

    .ttt-cell.winner {
        background: var(--gradient);
        animation: winPulse 0.6s ease;
    }

    @keyframes winPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    .game-status {
        text-align: center;
        font-size: 1.8rem;
        font-weight: 700;
        margin: 30px 0;
        color: var(--text-primary);
        min-height: 50px;
    }

    /* ===== BOTTLE GAME ===== */
    .bottle-setup {
        max-width: 600px;
        margin: 0 auto;
    }

    .player-inputs {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin: 20px 0;
    }

    .player-input-row {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .player-input-row input {
        flex: 1;
    }

    .remove-player {
        width: 40px;
        height: 40px;
        background: var(--bg-tertiary);
        border: 1px solid var(--border);
        border-radius: 8px;
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .remove-player:hover {
        background: #ef4444;
        color: white;
    }

    .level-selector {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin: 30px 0;
        flex-wrap: wrap;
    }

    .level-btn {
        padding: 12px 30px;
        background: var(--bg-tertiary);
        border: 2px solid var(--border);
        border-radius: 12px;
        color: var(--text-primary);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .level-btn:hover {
        border-color: var(--accent);
        transform: translateY(-2px);
    }

    .level-btn.active {
        background: var(--gradient);
        border-color: var(--accent);
        color: white;
        box-shadow: 0 5px 15px var(--accent-glow);
    }

    .bottle-container {
        position: relative;
        width: 350px;
        height: 350px;
        margin: 50px auto;
    }

    .bottle-circle {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 320px;
        height: 320px;
        border: 3px dashed var(--border);
        border-radius: 50%;
    }

    .bottle {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 25px;
        height: 140px;
        background: var(--gradient);
        border-radius: 12px 12px 6px 6px;
        transform-origin: 12.5px 12.5px;
        transform: translate(-12.5px, -12.5px);
        transition: transform 4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        cursor: pointer;
        box-shadow: 0 0 20px var(--accent-glow);
    }

    .bottle::before {
        content: '';
        position: absolute;
        top: -18px;
        left: 50%;
        transform: translateX(-50%);
        width: 15px;
        height: 18px;
        background: var(--accent-hover);
        border-radius: 4px 4px 0 0;
    }

    .bottle.spinning {
        transition: transform 5s cubic-bezier(0.17, 0.67, 0.3, 1.33);
    }

    .players-circle {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 350px;
        height: 350px;
    }

    .player-marker {
        position: absolute;
        padding: 8px 16px;
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 2px solid var(--border);
        border-radius: 20px;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .player-marker.selected {
        background: var(--gradient);
        border-color: var(--accent);
        color: white;
        transform: scale(1.2);
        box-shadow: 0 0 30px var(--accent-glow);
    }

    .task-display {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 30px;
        margin: 30px 0;
        text-align: center;
        font-size: 1.4rem;
        min-height: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1.6;
    }

    /* ===== HISTORY SIDEBAR ===== */
    .history-sidebar {
        position: fixed;
        right: -450px;
        top: 0;
        width: 450px;
        height: 100%;
        background: var(--bg-glass);
        backdrop-filter: blur(30px);
        border-left: 1px solid var(--border);
        z-index: 999;
        transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        overflow-y: auto;
        box-shadow: -10px 0 50px var(--shadow);
    }

    .history-sidebar.open {
        right: 0;
    }

    .history-header {
        padding: 25px;
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 0;
        background: var(--bg-secondary);
        backdrop-filter: blur(20px);
        z-index: 1;
    }

    .history-title {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 15px;
    }

    .history-controls {
        display: flex;
        gap: 10px;
    }

    .history-content {
        padding: 20px;
    }

    .history-item {
        background: var(--bg-tertiary);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 15px;
        transition: all 0.3s ease;
        animation: slideInRight 0.3s ease;
    }

    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    .history-item:hover {
        transform: translateX(-5px);
        border-color: var(--accent);
    }

    .history-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }

    .history-user {
        font-weight: 600;
        color: var(--text-primary);
    }

    .history-time {
        font-size: 0.85rem;
        color: var(--text-muted);
    }

    .history-game {
        color: var(--accent);
        font-weight: 600;
        margin-bottom: 5px;
    }

    .history-result {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .history-toggle {
        position: fixed;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        background: var(--gradient);
        color: white;
        padding: 20px 12px;
        border-radius: 12px 0 0 12px;
        cursor: pointer;
        z-index: 998;
        transition: all 0.3s ease;
        box-shadow: -5px 0 20px var(--accent-glow);
    }

    .history-toggle:hover {
        padding-right: 20px;
    }

    /* ===== ADMIN PANEL ===== */
    .admin-panel {
        position: fixed;
        bottom: 20px;
        left: 20px;
        background: var(--bg-glass);
        backdrop-filter: blur(30px);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 20px;
        max-width: 400px;
        max-height: 500px;
        overflow-y: auto;
        z-index: 1000;
        box-shadow: 0 10px 40px var(--shadow);
        transform: translateY(calc(100% + 40px));
        transition: transform 0.4s ease;
    }

    .admin-panel.open {
        transform: translateY(0);
    }

    .admin-toggle {
        position: fixed;
        bottom: 20px;
        left: 20px;
        width: 50px;
        height: 50px;
        background: var(--gradient);
        color: white;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 999;
        transition: all 0.3s ease;
        box-shadow: 0 5px 20px var(--accent-glow);
    }

    .admin-toggle:hover {
        transform: scale(1.1);
    }

    .admin-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 15px;
        color: var(--text-primary);
    }

    .admin-user {
        background: var(--bg-tertiary);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 10px;
    }

    .admin-user-name {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 5px;
    }

    .admin-user-info {
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    /* ===== MODAL ===== */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        z-index: 9999;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.3s ease;
    }

    .modal.active {
        display: flex;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .modal-content {
        background: var(--bg-glass);
        backdrop-filter: blur(30px);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 40px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        animation: scaleIn 0.3s ease;
        box-shadow: 0 20px 60px var(--shadow);
    }

    @keyframes scaleIn {
        from {
            opacity: 0;
            transform: scale(0.9);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    .modal-header {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 20px;
        background: var(--gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .modal-body {
        margin: 25px 0;
    }

    .modal-footer {
        display: flex;
        gap: 15px;
        justify-content: flex-end;
    }

    /* ===== MINI GAMES GRID ===== */
    .mini-games-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 30px;
    }

    .mini-game-card {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .mini-game-card:hover {
        transform: translateY(-5px);
        border-color: var(--accent);
        box-shadow: 0 10px 30px var(--accent-glow);
    }

    .mini-game-icon {
        font-size: 2.5rem;
        margin-bottom: 10px;
    }

    .mini-game-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 768px) {
        .logo {
            font-size: 1.4rem;
        }

        .header-controls {
            gap: 8px;
        }

        .btn {
            padding: 10px 18px;
            font-size: 0.9rem;
        }

        .games-grid {
            grid-template-columns: 1fr;
        }

        .game-header-title {
            font-size: 1.8rem;
        }

        .ttt-board {
            max-width: 300px;
            gap: 10px;
        }

        .ttt-cell {
            font-size: 2.5rem;
        }

        .bottle-container {
            width: 280px;
            height: 280px;
        }

        .bottle-circle {
            width: 250px;
            height: 250px;
        }

        .history-sidebar {
            width: 100%;
            right: -100%;
        }

        .theme-selector {
            order: 3;
        }

        .admin-panel {
            max-width: calc(100% - 40px);
        }
    }

    /* ===== SCROLLBAR ===== */
    ::-webkit-scrollbar {
        width: 10px;
    }

    ::-webkit-scrollbar-track {
        background: var(--bg-secondary);
    }

    ::-webkit-scrollbar-thumb {
        background: var(--accent);
        border-radius: 5px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: var(--accent-hover);
    }
</style>
```

</head>
<body data-theme="dark">
    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="bg-orb"></div>
        <div class="bg-orb"></div>
        <div class="bg-orb"></div>
    </div>

```
<!-- Loading Screen -->
<div class="loading-screen" id="loadingScreen">
    <div class="loader-ring"></div>
    <div class="loading-text">Party Games Elite –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</div>
</div>

<!-- Header -->
<header class="header">
    <div class="header-content">
        <div class="logo" onclick="showScreen('menu')">üéÆ Party Games Elite</div>
        <div class="header-controls">
            <div class="user-info" id="userInfo" onclick="showUserProfile()">
                <div class="user-avatar" id="userAvatar">üë§</div>
                <div class="user-name" id="userName">–ì–æ—Å—Ç—å</div>
            </div>
            <div class="theme-selector">
                <div class="theme-option theme-dark active" data-theme="dark"></div>
                <div class="theme-option theme-discord" data-theme="discord"></div>
                <div class="theme-option theme-twitter" data-theme="twitter"></div>
                <div class="theme-option theme-emerald" data-theme="emerald"></div>
                <div class="theme-option theme-red" data-theme="red"></div>
                <div class="theme-option theme-light" data-theme="light"></div>
            </div>
            <button class="btn btn-icon" onclick="toggleSound()">üîä</button>
        </div>
    </div>
</header>

<!-- History Sidebar -->
<div class="history-toggle" id="historyToggle" onclick="toggleHistory()">üìú</div>
<div class="history-sidebar" id="historySidebar">
    <div class="history-header">
        <div class="history-title">–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä</div>
        <div class="history-controls">
            <button class="btn btn-secondary" onclick="toggleBots()">–ë–æ—Ç—ã: <span id="botsStatus">–í—ã–∫–ª</span></button>
            <button class="btn btn-secondary" onclick="clearHistory()">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
    </div>
    <div class="history-content" id="historyContent"></div>
</div>

<!-- Admin Panel -->
<div class="admin-toggle" onclick="toggleAdmin()">‚öôÔ∏è</div>
<div class="admin-panel" id="adminPanel">
    <div class="admin-title">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (DEMO)</div>
    <div id="adminContent"></div>
</div>

<!-- Main Container -->
<div class="container">
    <!-- Registration Screen -->
    <div class="screen active" id="registrationScreen">
        <div class="registration-screen glass-card">
            <h1 style="font-size: 2.5rem; text-align: center; margin-bottom: 30px;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
            <form class="reg-form" onsubmit="registerUser(event)">
                <div class="form-group">
                    <label class="form-label">–í–∞—à –Ω–∏–∫</label>
                    <input type="text" class="form-input" id="regNickname" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º">
                </div>
                <div class="form-group">
                    <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä</label>
                    <div class="avatar-selector" id="avatarSelector"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                    <button type="button" class="btn btn-secondary" onclick="linkTelegram()">üîó –ü—Ä–∏–≤—è–∑–∞—Ç—å Telegram</button>
                    <div id="telegramStatus" style="margin-top: 10px; color: var(--text-secondary);"></div>
                </div>
                <button type="submit" class="btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä–∞—Ç—å</button>
            </form>
        </div>
    </div>

    <!-- Menu Screen -->
    <div class="screen" id="menuScreen">
        <h1 style="font-size: 3rem; text-align: center; margin-bottom: 40px; font-weight: 800;">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É</h1>
        <div class="games-grid">
            <!-- Main Games -->
            <div class="game-card" onclick="showScreen('tictactoe')">
                <div class="game-icon">‚ùå‚≠ï</div>
                <div class="game-title">–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</div>
                <div class="game-desc">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∏–≥—Ä–∞ –Ω–∞ –¥–≤–æ–∏—Ö —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π</div>
            </div>
            <div class="game-card" onclick="showScreen('bottle')">
                <div class="game-icon">üçæ</div>
                <div class="game-title">–ë—É—Ç—ã–ª–æ—á–∫–∞</div>
                <div class="game-desc">–ò–≥—Ä–∞ –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ —Å –∑–∞–¥–∞–Ω–∏—è–º–∏ 0+/16+/18+</div>
            </div>
            <div class="game-card" onclick="showScreen('truthordare')">
                <div class="game-icon">‚ùì</div>
                <div class="game-title">–ü—Ä–∞–≤–¥–∞ / –î–µ–π—Å—Ç–≤–∏–µ</div>
                <div class="game-desc">–û—Ç–∫—Ä–æ–≤–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –∑–∞–¥–∞–Ω–∏—è</div>
            </div>
            <div class="game-card" onclick="showScreen('minigames')">
                <div class="game-icon">üé≤</div>
                <div class="game-title">–ú–∏–Ω–∏-–∏–≥—Ä—ã</div>
                <div class="game-desc">25+ –±—ã—Å—Ç—Ä—ã—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π</div>
            </div>
        </div>
    </div>

    <!-- Tic Tac Toe Screen -->
    <div class="screen" id="tictactoeScreen">
        <div class="game-header">
            <h2 class="game-header-title">–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</h2>
            <button class="btn btn-secondary" onclick="showScreen('menu')">‚óÄ –ù–∞–∑–∞–¥</button>
        </div>
        <div class="game-status" id="tttStatus">–•–æ–¥: X</div>
        <div class="ttt-board" id="tttBoard"></div>
        <div style="text-align: center; margin-top: 30px;">
            <button class="btn" onclick="resetTicTacToe()">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        </div>
    </div>

    <!-- Bottle Screen -->
    <div class="screen" id="bottleScreen">
        <div class="game-header">
            <h2 class="game-header-title">–ë—É—Ç—ã–ª–æ—á–∫–∞</h2>
            <button class="btn btn-secondary" onclick="showScreen('menu')">‚óÄ –ù–∞–∑–∞–¥</button>
        </div>
        
        <!-- Setup -->
        <div id="bottleSetup" class="bottle-setup">
            <h3 style="text-align: center; margin-bottom: 25px; font-size: 1.8rem;">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–≥—Ä—ã</h3>
            <div class="player-inputs" id="bottlePlayerInputs">
                <div class="player-input-row">
                    <input type="text" class="form-input" placeholder="–ò–≥—Ä–æ–∫ 1" data-player-index="0">
                </div>
                <div class="player-input-row">
                    <input type="text" class="form-input" placeholder="–ò–≥—Ä–æ–∫ 2" data-player-index="1">
                </div>
            </div>
            <button class="btn btn-secondary" onclick="addBottlePlayer()" style="width: 100%; margin-bottom: 20px;">+ –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞</button>
            
            <div class="level-selector">
                <button class="level-btn active" data-level="0" onclick="selectBottleLevel(this)">0+</button>
                <button class="level-btn" data-level="16" onclick="selectBottleLevel(this)">16+</button>
                <button class="level-btn" data-level="18" onclick="selectBottleLevel(this)">18+</button>
            </div>
            
            <button class="btn" onclick="startBottleGame()" style="width: 100%; margin-top: 20px;">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        </div>
        
        <!-- Game -->
        <div id="bottleGame" style="display: none;">
            <div class="bottle-container">
                <div class="bottle-circle"></div>
                <div class="players-circle" id="bottlePlayersCircle"></div>
                <div class="bottle" id="bottle" onclick="spinBottle()"></div>
            </div>
            <div class="task-display" id="bottleTask">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –±—É—Ç—ã–ª–æ—á–∫—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="backToBottleSetup()">‚óÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            </div>
        </div>
    </div>

    <!-- Truth or Dare Screen -->
    <div class="screen" id="truthordareScreen">
        <div class="game-header">
            <h2 class="game-header-title">–ü—Ä–∞–≤–¥–∞ / –î–µ–π—Å—Ç–≤–∏–µ</h2>
            <button class="btn btn-secondary" onclick="showScreen('menu')">‚óÄ –ù–∞–∑–∞–¥</button>
        </div>
        
        <!-- Mode Selection -->
        <div id="todModeSelect">
            <h3 style="text-align: center; margin-bottom: 30px; font-size: 1.8rem;">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º</h3>
            <div class="level-selector">
                <button class="level-btn active" data-level="0" onclick="selectTODLevel(this)">0+</button>
                <button class="level-btn" data-level="16" onclick="selectTODLevel(this)">16+</button>
                <button class="level-btn" data-level="18" onclick="selectTODLevel(this)">18+</button>
            </div>
            <div style="display: flex; gap: 20px; justify-content: center; margin-top: 40px; flex-wrap: wrap;">
                <button class="btn" onclick="startTODDuo()">–ù–∞ –¥–≤–æ–∏—Ö</button>
                <button class="btn" onclick="startTODCompany()">–ö–æ–º–ø–∞–Ω–∏—è</button>
            </div>
        </div>
        
        <!-- Company Setup -->
        <div id="todCompanySetup" style="display: none;">
            <div class="bottle-setup">
                <h3 style="text-align: center; margin-bottom: 25px; font-size: 1.8rem;">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–≥—Ä–æ–∫–æ–≤</h3>
                <div class="player-inputs" id="todPlayerInputs">
                    <div class="player-input-row">
                        <input type="text" class="form-input" placeholder="–ò–≥—Ä–æ–∫ 1" data-player-index="0">
                    </div>
                    <div class="player-input-row">
                        <input type="text" class="form-input" placeholder="–ò–≥—Ä–æ–∫ 2" data-player-index="1">
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="addTODPlayer()" style="width: 100%; margin-bottom: 20px;">+ –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞</button>
                <button class="btn" onclick="startTODCompanyGame()" style="width: 100%;">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            </div>
        </div>
        
        <!-- Game -->
        <div id="todGame" style="display: none;">
            <div id="todBottleContainer" style="display: none;">
                <div class="bottle-container">
                    <div class="bottle-circle"></div>
                    <div class="players-circle" id="todPlayersCircle"></div>
                    <div class="bottle" id="todBottle" onclick="spinTODBottle()"></div>
                </div>
            </div>
            <div class="task-display" id="todCurrentPlayer">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –±—É—Ç—ã–ª–æ—á–∫—É</div>
            <div style="display: flex; gap: 20px; justify-content: center; margin: 30px 0; flex-wrap: wrap;">
                <button class="btn" onclick="chooseTruth()">–ü—Ä–∞–≤–¥–∞</button>
                <button class="btn" onclick="chooseDare()">–î–µ–π—Å—Ç–≤–∏–µ</button>
            </div>
            <div class="task-display" id="todTask" style="display: none;"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-secondary" id="todNext" onclick="nextTODTurn()" style="display: none;">–°–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥</button>
                <button class="btn btn-secondary" onclick="backToTODMode()">‚óÄ –†–µ–∂–∏–º</button>
            </div>
        </div>
    </div>

    <!-- Mini Games Screen -->
    <div class="screen" id="minigamesScreen">
        <div class="game-header">
            <h2 class="game-header-title">–ú–∏–Ω–∏-–∏–≥—Ä—ã</h2>
            <button class="btn btn-secondary" onclick="showScreen('menu')">‚óÄ –ù–∞–∑–∞–¥</button>
        </div>
        <div class="mini-games-grid" id="miniGamesGrid"></div>
    </div>
</div>

<!-- Mini Game Modal -->
<div class="modal" id="miniGameModal">
    <div class="modal-content">
        <div class="modal-header" id="miniGameTitle"></div>
        <div class="modal-body" id="miniGameContent"></div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeMiniGame()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>

<script>
    // ===== GLOBAL STATE =====
    let currentUser = null;
    let soundEnabled = true;
    let currentTheme = 'dark';
    let gameHistory = JSON.parse(localStorage.getItem('gameHistory')) || [];
    let botsEnabled = false;
    let adminUsers = JSON.parse(localStorage.getItem('adminUsers')) || [];

    // ===== AVATARS =====
    const avatars = ['üòÄ', 'üòé', 'ü§©', 'ü•≥', 'ü§ì', 'üòá', 'ü§†', 'ü•∏', 'ü§°', 'üëΩ', 'ü§ñ', 'üéÉ', 'üê±', 'üê∂', 'üêº', 'ü¶ä'];

    // ===== AUDIO CONTEXT =====
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(frequency, duration) {
        if (!soundEnabled) return;
        try {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        } catch (e) {}
    }

    function playClick() { playSound(800, 0.1); }
    function playSuccess() { playSound(1200, 0.2); }
    function playError() { playSound(300, 0.3); }
    function playSpin() { playSound(600, 2); }

    // ===== INITIALIZATION =====
    window.addEventListener('load', () => {
        initAvatarSelector();
        initThemeSelector();
        
        // Check if user is registered
        const savedUser = localStorage.getItem('currentUser');
        if (savedUser) {
            currentUser = JSON.parse(savedUser);
            updateUserDisplay();
            showScreen('menu');
        }
        
        setTimeout(() => {
            document.getElementById('loadingScreen').classList.add('hidden');
        }, 1500);
        
        updateHistoryDisplay();
        updateAdminPanel();
        initMiniGames();
        
        // Auto-start bot activity if enabled
        if (botsEnabled) {
            setInterval(addBotActivity, 30000);
        }
    });

    // ===== USER MANAGEMENT =====
    function initAvatarSelector() {
        const selector = document.getElementById('avatarSelector');
        avatars.forEach((avatar, index) => {
            const option = document.createElement('div');
            option.className = 'avatar-option';
            option.textContent = avatar;
            option.onclick = () => selectAvatar(option, avatar);
            if (index === 0) {
                option.classList.add('selected');
                option.dataset.selected = 'true';
            }
            selector.appendChild(option);
        });
    }

    function selectAvatar(element, avatar) {
        document.querySelectorAll('.avatar-option').forEach(el => {
            el.classList.remove('selected');
            el.dataset.selected = 'false';
        });
        element.classList.add('selected');
        element.dataset.selected = 'true';
        playClick();
    }

    function linkTelegram() {
        // Demo mode - simulate Telegram link
        const mockTgUsername = 'user_' + Math.random().toString(36).substr(2, 9);
        document.getElementById('telegramStatus').innerHTML = `
            <div style="color: var(--accent); font-weight: 600;">
                ‚úì Telegram –ø—Ä–∏–≤—è–∑–∞–Ω: @${mockTgUsername}
            </div>
        `;
        playSuccess();
    }

    function registerUser(event) {
        event.preventDefault();
        
        const nickname = document.getElementById('regNickname').value.trim() || '–ì–æ—Å—Ç—å';
        const selectedAvatar = document.querySelector('.avatar-option.selected').textContent;
        const telegramStatus = document.getElementById('telegramStatus').innerHTML;
        const hasTelegram = telegramStatus.includes('–ø—Ä–∏–≤—è–∑–∞–Ω');
        
        currentUser = {
            id: Date.now(),
            nickname: nickname,
            avatar: selectedAvatar,
            telegram: hasTelegram ? telegramStatus.match(/@(\w+)/)?.[1] : null,
            registered: new Date().toISOString(),
            ip: '192.168.1.' + Math.floor(Math.random() * 255), // Mock IP
            token: 'TK' + Math.random().toString(36).substr(2, 16).toUpperCase() // Mock token
        };
        
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        adminUsers.push(currentUser);
        localStorage.setItem('adminUsers', JSON.stringify(adminUsers));
        
        updateUserDisplay();
        updateAdminPanel();
        showScreen('menu');
        playSuccess();
    }

    function updateUserDisplay() {
        if (currentUser) {
            document.getElementById('userAvatar').textContent = currentUser.avatar;
            document.getElementById('userName').textContent = currentUser.nickname;
        }
    }

    function showUserProfile() {
        alert(`–ü—Ä–æ—Ñ–∏–ª—å:\n–ù–∏–∫: ${currentUser.nickname}\n${currentUser.telegram ? 'Telegram: @' + currentUser.telegram : 'Telegram –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω'}`);
        playClick();
    }

    // ===== THEME MANAGEMENT =====
    function initThemeSelector() {
        document.querySelectorAll('.theme-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.theme-option').forEach(el => el.classList.remove('active'));
                this.classList.add('active');
                currentTheme = this.dataset.theme;
                document.body.setAttribute('data-theme', currentTheme);
                playClick();
            });
        });
    }

    function toggleSound() {
        soundEnabled = !soundEnabled;
        event.target.textContent = soundEnabled ? 'üîä' : 'üîá';
        playClick();
    }

    // ===== SCREEN MANAGEMENT =====
    function showScreen(screenId) {
        document.querySelectorAll('.screen').forEach(screen => {
            screen.classList.remove('active');
        });
        
        const targetScreen = document.getElementById(screenId + 'Screen');
        if (targetScreen) {
            targetScreen.classList.add('active');
            playClick();
            
            // Initialize game if needed
            if (screenId === 'tictactoe') initTicTacToe();
        }
    }

    // ===== HISTORY MANAGEMENT =====
    function toggleHistory() {
        document.getElementById('historySidebar').classList.toggle('open');
        playClick();
    }

    function addToHistory(game, result, user = null) {
        const entry = {
            user: user || (currentUser ? currentUser.nickname : '–ì–æ—Å—Ç—å'),
            avatar: user ? 'ü§ñ' : (currentUser ? currentUser.avatar : 'üë§'),
            game: game,
            result: result,
            time: new Date().toLocaleString('ru-RU'),
            timestamp: Date.now()
        };
        
        gameHistory.unshift(entry);
        if (gameHistory.length > 100) gameHistory.pop();
        localStorage.setItem('gameHistory', JSON.stringify(gameHistory));
        updateHistoryDisplay();
    }

    function updateHistoryDisplay() {
        const content = document.getElementById('historyContent');
        if (gameHistory.length === 0) {
            content.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 20px;">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</p>';
            return;
        }
        
        content.innerHTML = gameHistory.map(entry => `
            <div class="history-item">
                <div class="history-meta">
                    <div class="history-user">${entry.avatar} ${entry.user}</div>
                    <div class="history-time">${entry.time}</div>
                </div>
                <div class="history-game">${entry.game}</div>
                <div class="history-result">${entry.result}</div>
            </div>
        `).join('');
    }

    function clearHistory() {
        if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é?')) {
            gameHistory = [];
            localStorage.setItem('gameHistory', JSON.stringify(gameHistory));
            updateHistoryDisplay();
            playClick();
        }
    }

    function toggleBots() {
        botsEnabled = !botsEnabled;
        document.getElementById('botsStatus').textContent = botsEnabled ? '–í–∫–ª' : '–í—ã–∫–ª';
        playClick();
        
        if (botsEnabled) {
            addBotActivity();
        }
    }

    function addBotActivity() {
        if (!botsEnabled) return;
        
        const botNames = ['–ì–æ—Å—Ç—å', 'Andrey', '–†–æ–º–∞', '–õ–µ–Ω–∞', '–ü–æ–ª–∏–Ω–∞', '–ú–∞–∫—Å', '–î–∞—à–∞', '–ò–≥–æ—Ä—å'];
        const games = ['–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏', '–ë—É—Ç—ã–ª–æ—á–∫–∞', '–ü—Ä–∞–≤–¥–∞/–î–µ–π—Å—Ç–≤–∏–µ', '–ö–∞–º–µ–Ω—å-–Ω–æ–∂–Ω–∏—Ü—ã-–±—É–º–∞–≥–∞', '–†—É–ª–µ—Ç–∫–∞'];
        const results = ['–ü–æ–±–µ–¥–∞', '–ü–æ—Ä–∞–∂–µ–Ω–∏–µ', '–ù–∏—á—å—è', '–í—ã–ø–æ–ª–Ω–∏–ª –∑–∞–¥–∞–Ω–∏–µ', '–ü—Ä–æ–ø—É—Å—Ç–∏–ª —Ö–æ–¥'];
        
        const botName = botNames[Math.floor(Math.random() * botNames.length)];
        const game = games[Math.floor(Math.random() * games.length)];
        const result = results[Math.floor(Math.random() * results.length)];
        
        addToHistory(game, result, botName);
    }

    // ===== ADMIN PANEL =====
    function toggleAdmin() {
        document.getElementById('adminPanel').classList.toggle('open');
        playClick();
    }

    function updateAdminPanel() {
        const content = document.getElementById('adminContent');
        if (adminUsers.length === 0) {
            content.innerHTML = '<p style="color: var(--text-muted);">–ù–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>';
            return;
        }
        
        content.innerHTML = adminUsers.map(user => `
            <div class="admin-user">
                <div class="admin-user-name">${user.avatar} ${user.nickname}</div>
                <div class="admin-user-info">
                    –°—Ç–∞—Ç—É—Å: ${user.telegram ? 'Telegram (@' + user.telegram + ')' : '–ì–æ—Å—Ç—å'}<br>
                    IP: ${user.ip} (DEMO)<br>
                    Token: ${user.token} (DEMO)
                </div>
            </div>
        `).join('');
    }

    // ===== TIC TAC TOE =====
    let tttBoard = Array(9).fill('');
    let tttCurrentPlayer = 'X';
    let tttActive = true;

    function initTicTacToe() {
        const board = document.getElementById('tttBoard');
        board.innerHTML = '';
        
        for (let i = 0; i < 9; i++) {
            const cell = document.createElement('div');
            cell.className = 'ttt-cell';
            cell.dataset.index = i;
            cell.onclick = () => handleTTTClick(i, cell);
            board.appendChild(cell);
        }
        
        resetTicTacToe();
    }

    function handleTTTClick(index, cell) {
        if (!tttActive || tttBoard[index] || cell.classList.contains('filled')) return;
        
        tttBoard[index] = tttCurrentPlayer;
        cell.textContent = tttCurrentPlayer;
        cell.classList.add('filled');
        playClick();
        
        if (checkTTTWinner()) {
            document.getElementById('tttStatus').textContent = `–ü–æ–±–µ–¥–∏–ª ${tttCurrentPlayer}!`;
            tttActive = false;
            highlightTTTWinner();
            playSuccess();
            addToHistory('–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏', `–ü–æ–±–µ–¥–∏–ª ${tttCurrentPlayer}`);
        } else if (tttBoard.every(cell => cell !== '')) {
            document.getElementById('tttStatus').textContent = '–ù–∏—á—å—è!';
            tttActive = false;
            addToHistory('–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏', '–ù–∏—á—å—è');
        } else {
            tttCurrentPlayer = tttCurrentPlayer === 'X' ? 'O' : 'X';
            document.getElementById('tttStatus').textContent = `–•–æ–¥: ${tttCurrentPlayer}`;
        }
    }

    function checkTTTWinner() {
        const lines = [
            [0,1,2], [3,4,5], [6,7,8],
            [0,3,6], [1,4,7], [2,5,8],
            [0,4,8], [2,4,6]
        ];
        
        return lines.some(([a,b,c]) => {
            return tttBoard[a] && tttBoard[a] === tttBoard[b] && tttBoard[a] === tttBoard[c];
        });
    }

    function highlightTTTWinner() {
        const lines = [
            [0,1,2], [3,4,5], [6,7,8],
            [0,3,6], [1,4,7], [2,5,8],
            [0,4,8], [2,4,6]
        ];
        
        lines.forEach(([a,b,c]) => {
            if (tttBoard[a] && tttBoard[a] === tttBoard[b] && tttBoard[a] === tttBoard[c]) {
                const cells = document.querySelectorAll('.ttt-cell');
                cells[a].classList.add('winner');
                cells[b].classList.add('winner');
                cells[c].classList.add('winner');
            }
        });
    }

    function resetTicTacToe() {
        tttBoard = Array(9).fill('');
        tttCurrentPlayer = 'X';
        tttActive = true;
        document.getElementById('tttStatus').textContent = '–•–æ–¥: X';
        document.querySelectorAll('.ttt-cell').forEach(cell => {
            cell.textContent = '';
            cell.classList.remove('filled', 'winner');
        });
        playClick();
    }

    // ===== BOTTLE GAME =====
    const bottleTasks = {
        0: [
            {text: "–°–ø–æ–π –ø–µ—Å–Ω—é", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –∞–Ω–µ–∫–¥–æ—Ç", repeatable: true},
            {text: "–°–¥–µ–ª–∞–π 10 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π", repeatable: true},
            {text: "–ò–∑–æ–±—Ä–∞–∑–∏ –∂–∏–≤–æ—Ç–Ω–æ–µ", repeatable: true},
            {text: "–ü—Ä–æ–∫—É–∫–∞—Ä–µ–∫–∞–π 3 —Ä–∞–∑–∞", repeatable: false},
            {text: "–°—Ç–∞–Ω—Ü—É–π –º–∏–Ω—É—Ç—É", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ —Å—Ç–∏—Ö", repeatable: false},
            {text: "–ü–æ–∫–∞–∂–∏ –ø–∞–Ω—Ç–æ–º–∏–º—É", repeatable: true},
            {text: "–°–¥–µ–ª–∞–π –ø–ª–∞–Ω–∫—É 30 —Å–µ–∫—É–Ω–¥", repeatable: true},
            {text: "–ò–∑–æ–±—Ä–∞–∑–∏ —Å—Ç–∞—Ç—É—é 1 –º–∏–Ω—É—Ç—É", repeatable: true},
            {text: "–ù–∞–∑–æ–≤–∏ 10 –≥–æ—Ä–æ–¥–æ–≤", repeatable: false},
            {text: "–°–ø–æ–π –∫–æ–ª—ã–±–µ–ª—å–Ω—É—é", repeatable: true},
            {text: "–°–¥–µ–ª–∞–π –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç –≤—Å–µ–º", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–≤–æ—ë–º –¥–Ω–µ", repeatable: true},
            {text: "–ü–æ–∫–∞–∂–∏ —Å–≤–æ–π —Ç–∞–ª–∞–Ω—Ç", repeatable: true},
            {text: "–ò–∑–æ–±—Ä–∞–∑–∏ —Ä–æ–±–æ—Ç–∞", repeatable: true},
            {text: "–ü–æ–ø—Ä—ã–≥–∞–π –Ω–∞ –æ–¥–Ω–æ–π –Ω–æ–≥–µ", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ —Å–º–µ—à–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é", repeatable: true},
            {text: "–ò–∑–æ–±—Ä–∞–∑–∏ –∑–Ω–∞–º–µ–Ω–∏—Ç–æ—Å—Ç—å", repeatable: true},
            {text: "–°–¥–µ–ª–∞–π –π–æ–≥—É", repeatable: true},
            {text: "–ü–æ–∫–∞–∂–∏ –∞–∫—Ä–æ–±–∞—Ç–∏–∫—É", repeatable: true},
            {text: "–ò–∑–æ–±—Ä–∞–∑–∏ –≤–µ—Ç–µ—Ä", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –æ –º–µ—á—Ç–µ", repeatable: true},
            {text: "–°–ø–æ–π –∑–∞–¥–æ–º –Ω–∞–ø–µ—Ä—ë–¥", repeatable: true},
            {text: "–ò–∑–æ–±—Ä–∞–∑–∏ –¥–æ–∂–¥—å", repeatable: true},
            {text: "–ü–æ–∫–∞–∂–∏ —Ä–∞–¥–æ—Å—Ç—å", repeatable: true},
            {text: "–°–¥–µ–ª–∞–π –∑–∞—Ä—è–¥–∫—É", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –æ —Ö–æ–±–±–∏", repeatable: true},
            {text: "–ò–∑–æ–±—Ä–∞–∑–∏ –≥—Ä—É—Å—Ç—å", repeatable: true},
            {text: "–ü–æ–∫–∞–∂–∏ —Å—Ç—Ä–∞—Ö", repeatable: true}
        ],
        16: [
            {text: "–û–±–Ω–∏–º–∏ –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –≤ —â—ë–∫—É –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–°–¥–µ–ª–∞–π –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–î–µ—Ä–∂–∏—Å—å –∑–∞ —Ä—É–∫—É —Å –∏–≥—Ä–æ–∫–æ–º {player} 5 –º–∏–Ω—É—Ç", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π —Ä—É–∫—É –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–û–±–Ω–∏–º–∏ –∏–≥—Ä–æ–∫–∞ {player} —Å–∑–∞–¥–∏", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –≤ –ª–æ–± –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–ú–∞—Å—Å–∞–∂ –ø–ª–µ—á –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –≤ –Ω–æ—Å –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–ü–æ–≥–ª–∞–¥—å –ø–æ –≥–æ–ª–æ–≤–µ –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–ü—Ä–∏–∑–Ω–∞–π—Å—è –≤ —Å–∏–º–ø–∞—Ç–∏–∏ –∏–≥—Ä–æ–∫—É {player}", repeatable: false},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –æ –ø–µ—Ä–≤–æ–º –ø–æ—Ü–µ–ª—É–µ", repeatable: false},
            {text: "–ü–æ—Ü–µ–ª—É–π –ª–∞–¥–æ–Ω—å –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–û–±–Ω–∏–º–∏—Å—å —Å –∏–≥—Ä–æ–∫–æ–º {player} –ª—ë–∂–∞", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–≤–æ—ë–º –∫—Ä–∞—à–µ", repeatable: false},
            {text: "–ü–æ—Ü–µ–ª—É–π –ø–ª–µ—á–æ –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–°—è–¥—å –Ω–∞ –∫–æ–ª–µ–Ω–∏ –∫ –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π —É—Ö–æ –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ —Ä–æ–º–∞–Ω—Ç–∏—á–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π —à–µ—é –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–û–±–Ω–∏–º–∏ –∏–≥—Ä–æ–∫–∞ {player} –∑–∞ —Ç–∞–ª–∏—é", repeatable: true},
            {text: "–ü—Ä–∏–∑–Ω–∞–π—Å—è –∫—Ç–æ –Ω—Ä–∞–≤–∏—Ç—Å—è", repeatable: false},
            {text: "–ü–æ—Ü–µ–ª—É–π –∫–ª—é—á–∏—Ü—É –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–ü—Ä–∏–∂–º–∏—Å—å –∫ –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –æ –º–µ—á—Ç–∞—Ö", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} –≤ –≥—É–±—ã", repeatable: true},
            {text: "–û–±–Ω–∏–º–∏ –∏–≥—Ä–æ–∫–∞ {player} –∫—Ä–µ–ø–∫–æ", repeatable: true},
            {text: "–ú–∞—Å—Å–∞–∂ —Å–ø–∏–Ω—ã –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ —á—Ç–æ –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} –¥–æ–ª–≥–æ", repeatable: true}
        ],
        18: [
            {text: "–°—Ç—Ä–∞—Å—Ç–Ω–æ –ø–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –æ —Ñ–∞–Ω—Ç–∞–∑–∏—è—Ö", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} —Å —è–∑—ã–∫–æ–º", repeatable: true},
            {text: "–ü—Ä–∏–∑–Ω–∞–π—Å—è –≤ —Å–æ–∫—Ä–æ–≤–µ–Ω–Ω–æ–º", repeatable: false},
            {text: "–ú–∞—Å—Å–∞–∂ –≤–µ–∑–¥–µ –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ —á—Ç–æ –≤–æ–∑–±—É–∂–¥–∞–µ—Ç", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} –≤–µ–∑–¥–µ", repeatable: true},
            {text: "–ü—Ä–∏–∂–º–∏—Å—å –∏–Ω—Ç–∏–º–Ω–æ –∫ –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–∫—Å—É–∞–ª—å–Ω–æ–º –æ–ø—ã—Ç–µ", repeatable: false},
            {text: "–ü–æ—Ü–µ–ª—É–π —ç—Ä–æ–≥–µ–Ω–Ω—ã–µ –∑–æ–Ω—ã –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–ü—Ä–∏–∑–Ω–∞–π—Å—è —á—Ç–æ —Ö–æ—á–µ—à—å –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å", repeatable: false},
            {text: "–û–±–Ω–∏–º–∏ –∏–≥—Ä–æ–∫–∞ {player} –≤ –ø–æ—Å—Ç–µ–ª–∏ (–∏–º–∏—Ç–∞—Ü–∏—è)", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –æ –∂–µ–ª–∞–Ω–∏—è—Ö", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} —Å–æ–±–ª–∞–∑–Ω–∏—Ç–µ–ª—å–Ω–æ", repeatable: true},
            {text: "–ú–∞—Å—Å–∞–∂ –∏–Ω—Ç–∏–º–Ω—ã–π –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –∫—É–¥–∞ –ª—é–±–∏—à—å –ø–æ—Ü–µ–ª—É–∏", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} —á—É–≤—Å—Ç–≤–µ–Ω–Ω–æ", repeatable: true},
            {text: "–ü—Ä–∏–∑–Ω–∞–π—Å—è –æ —Ç–∞–π–Ω—ã—Ö –∂–µ–ª–∞–Ω–∏—è—Ö", repeatable: false},
            {text: "–ü—Ä–∏–∂–º–∏—Å—å –≤–æ–∑–±—É–∂–¥–∞—é—â–µ –∫ –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–∞–º–æ–º —Å—Ç—Ä–∞—Å—Ç–Ω–æ–º", repeatable: false},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω–æ", repeatable: true},
            {text: "–û–±–Ω–∏–º–∏ –∏–≥—Ä–æ–∫–∞ {player} —Å—Ç—Ä–∞—Å—Ç–Ω–æ", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ —á—Ç–æ –¥–ª—è —Ç–µ–±—è –∏–¥–µ–∞–ª –≤ –ø–æ—Å—Ç–µ–ª–∏", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} –≥–æ—Ä—è—á–æ", repeatable: true},
            {text: "–ü—Ä–∏–∑–Ω–∞–π—Å—è –≥–¥–µ —ç—Ä–æ–≥–µ–Ω–Ω–∞—è –∑–æ–Ω–∞", repeatable: false},
            {text: "–ú–∞—Å—Å–∞–∂ —Å—Ç—Ä–∞—Å—Ç–Ω—ã–π –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–∞–º–æ–º –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω–æ–º", repeatable: false},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} —Å –∂–µ–ª–∞–Ω–∏–µ–º", repeatable: true},
            {text: "–ü—Ä–∏–∑–Ω–∞–π—Å—è –≤ —Å–æ–∫—Ä–æ–≤–µ–Ω–Ω–æ–π –º–µ—á—Ç–µ", repeatable: false},
            {text: "–û–±–Ω–∏–º–∏ –∏–≥—Ä–æ–∫–∞ {player} –≤ —ç–∫—Å—Ç–∞–∑–µ (–∏–º–∏—Ç–∞—Ü–∏—è)", repeatable: true}
        ]
    };

    let bottlePlayers = [];
    let bottleLevel = 0;
    let bottleUsedTasks = [];
    let bottleSelectedPlayer = -1;

    function addBottlePlayer() {
        const container = document.getElementById('bottlePlayerInputs');
        const index = container.children.length;
        const row = document.createElement('div');
        row.className = 'player-input-row';
        row.innerHTML = `
            <input type="text" class="form-input" placeholder="–ò–≥—Ä–æ–∫ ${index + 1}" data-player-index="${index}">
            <button class="remove-player" onclick="removeBottlePlayer(this)">‚úï</button>
        `;
        container.appendChild(row);
        playClick();
    }

    function removeBottlePlayer(button) {
        if (document.getElementById('bottlePlayerInputs').children.length > 2) {
            button.parentElement.remove();
            playClick();
        } else {
            alert('–ú–∏–Ω–∏–º—É–º 2 –∏–≥—Ä–æ–∫–∞!');
        }
    }

    function selectBottleLevel(button) {
        document.querySelectorAll('#bottleSetup .level-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        button.classList.add('active');
        bottleLevel = parseInt(button.dataset.level);
        playClick();
    }

    function startBottleGame() {
        const inputs = document.querySelectorAll('#bottlePlayerInputs input');
        bottlePlayers = Array.from(inputs).map((input, i) => input.value.trim() || `–ò–≥—Ä–æ–∫ ${i + 1}`);
        
        if (bottlePlayers.length < 2) {
            alert('–ú–∏–Ω–∏–º—É–º 2 –∏–≥—Ä–æ–∫–∞!');
            return;
        }
        
        document.getElementById('bottleSetup').style.display = 'none';
        document.getElementById('bottleGame').style.display = 'block';
        bottleUsedTasks = [];
        updateBottlePlayers();
        playClick();
    }

    function updateBottlePlayers() {
        const circle = document.getElementById('bottlePlayersCircle');
        circle.innerHTML = '';
        
        const radius = 140;
        const angleStep = (2 * Math.PI) / bottlePlayers.length;
        
        bottlePlayers.forEach((player, index) => {
            const angle = index * angleStep - Math.PI / 2;
            const x = radius * Math.cos(angle);
            const y = radius * Math.sin(angle);
            
            const marker = document.createElement('div');
            marker.className = 'player-marker';
            marker.textContent = player;
            marker.style.left = `calc(50% + ${x}px)`;
            marker.style.top = `calc(50% + ${y}px)`;
            marker.style.transform = 'translate(-50%, -50%)';
            marker.dataset.index = index;
            
            if (index === bottleSelectedPlayer) {
                marker.classList.add('selected');
            }
            
            circle.appendChild(marker);
        });
    }

    function spinBottle() {
        const bottle = document.getElementById('bottle');
        const rotations = 360 * 8 + Math.random() * 360;
        bottle.style.transform = `translate(-12.5px, -12.5px) rotate(${rotations}deg)`;
        bottle.classList.add('spinning');
        playSpin();
        
        setTimeout(() => {
            bottle.classList.remove('spinning');
            
            const finalAngle = rotations % 360;
            const angleStep = 360 / bottlePlayers.length;
            bottleSelectedPlayer = Math.floor((finalAngle + angleStep / 2) / angleStep) % bottlePlayers.length;
            
            updateBottlePlayers();
            
            const task = getBottleTask();
            document.getElementById('bottleTask').textContent = task;
            playSuccess();
            
            addToHistory('–ë—É—Ç—ã–ª–æ—á–∫–∞', `${bottlePlayers[bottleSelectedPlayer]} - ${task.substring(0, 50)}...`);
        }, 5000);
    }

    function getBottleTask() {
        const tasks = bottleTasks[bottleLevel];
        const availableTasks = tasks.filter(task => 
            !bottleUsedTasks.includes(task.text) || task.repeatable
        );
        
        if (availableTasks.length === 0) {
            bottleUsedTasks = [];
            return getBottleTask();
        }
        
        const task = availableTasks[Math.floor(Math.random() * availableTasks.length)];
        
        if (!task.repeatable) {
            bottleUsedTasks.push(task.text);
        }
        
        // Replace {player} with random player name
        if (task.text.includes('{player}')) {
            let targetPlayer = bottlePlayers[Math.floor(Math.random() * bottlePlayers.length)];
            // Make sure it's not the same player
            while (targetPlayer === bottlePlayers[bottleSelectedPlayer] && bottlePlayers.length > 1) {
                targetPlayer = bottlePlayers[Math.floor(Math.random() * bottlePlayers.length)];
            }
            return task.text.replace('{player}', targetPlayer);
        }
        
        return task.text;
    }

    function backToBottleSetup() {
        document.getElementById('bottleSetup').style.display = 'block';
        document.getElementById('bottleGame').style.display = 'none';
        document.getElementById('bottle').style.transform = 'translate(-12.5px, -12.5px) rotate(0deg)';
        playClick();
    }

    // ===== TRUTH OR DARE =====
    const truthTasks = {
        0: [
            {text: "–ö–∞–∫–æ–π —Ç–≤–æ–π –ª—é–±–∏–º—ã–π —Ü–≤–µ—Ç?", repeatable: true},
            {text: "–ß—Ç–æ —Ç—ã –µ–ª –Ω–∞ –∑–∞–≤—Ç—Ä–∞–∫?", repeatable: true},
            {text: "–¢–≤–æ–π –ª—é–±–∏–º—ã–π —Ñ–∏–ª—å–º?", repeatable: false},
            {text: "–ö–∞–∫–æ–µ —É —Ç–µ–±—è —Ö–æ–±–±–∏?", repeatable: false},
            {text: "–¢–≤–æ—ë –ª—é–±–∏–º–æ–µ –≤—Ä–µ–º—è –≥–æ–¥–∞?", repeatable: true},
            {text: "–ö–∞–∫–∞—è —Ç–≤–æ—è –º–µ—á—Ç–∞?", repeatable: false},
            {text: "–¢–≤–æ–π –ª—é–±–∏–º—ã–π –ø—Ä–µ–¥–º–µ—Ç –≤ —à–∫–æ–ª–µ?", repeatable: true},
            {text: "–ö–∞–∫—É—é –º—É–∑—ã–∫—É —Ç—ã —Å–ª—É—à–∞–µ—à—å?", repeatable: true},
            {text: "–¢–≤–æ—ë –ª—é–±–∏–º–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ?", repeatable: true},
            {text: "–ö—É–¥–∞ —Ç—ã —Ö–æ—á–µ—à—å –ø–æ–µ—Ö–∞—Ç—å?", repeatable: true},
            {text: "–ß—Ç–æ —Ç—ã –∫–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—à—å?", repeatable: true},
            {text: "–¢–≤–æ–π –ª—é–±–∏–º—ã–π –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏?", repeatable: true},
            {text: "–ö–∞–∫–æ–π —Ç–≤–æ–π —Ç–∞–ª–∞–Ω—Ç?", repeatable: false},
            {text: "–í–æ —Å–∫–æ–ª—å–∫–æ —Ç—ã –ª–æ–∂–∏—à—å—Å—è —Å–ø–∞—Ç—å?", repeatable: true},
            {text: "–¢–≤–æ–π –ª—é–±–∏–º—ã–π –Ω–∞–ø–∏—Ç–æ–∫?", repeatable: true},
            {text: "–ß—Ç–æ —Ç—ã –¥–µ–ª–∞–µ—à—å –ø–æ —É—Ç—Ä–∞–º?", repeatable: true},
            {text: "–¢–≤–æ—è –ª—é–±–∏–º–∞—è –∏–≥—Ä–∞?", repeatable: true},
            {text: "–ö–∞–∫–æ–π —Ç–≤–æ–π –ª—é–±–∏–º—ã–π –ø—Ä–∞–∑–¥–Ω–∏–∫?", repeatable: true},
            {text: "–ß—Ç–æ —Ç–µ–±—è –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç?", repeatable: true},
            {text: "–¢–≤–æ—è –ª—é–±–∏–º–∞—è –æ–¥–µ–∂–¥–∞?", repeatable: true}
        ],
        16: [
            {text: "–ö—Ç–æ —Ç–µ–±–µ –Ω—Ä–∞–≤–∏—Ç—Å—è?", repeatable: false},
            {text: "–ë—ã–ª –ª–∏ —É —Ç–µ–±—è –ø–µ—Ä–≤—ã–π –ø–æ—Ü–µ–ª—É–π?", repeatable: false},
            {text: "–û –∫–æ–º —Ç—ã –º–µ—á—Ç–∞–µ—à—å?", repeatable: true},
            {text: "–ß—Ç–æ —Ç–µ–±—è –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –≤ –ª—é–¥—è—Ö?", repeatable: true},
            {text: "–ë—ã–ª –ª–∏ —É —Ç–µ–±—è –∫—Ä–∞—à?", repeatable: false},
            {text: "–ö–æ–≥–æ —Ç—ã —Ö–æ—á–µ—à—å –ø–æ—Ü–µ–ª–æ–≤–∞—Ç—å?", repeatable: true},
            {text: "–ö–∞–∫–æ–µ —Ç–≤–æ—ë —Ä–æ–º–∞–Ω—Ç–∏—á–Ω–æ–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ?", repeatable: false},
            {text: "–û —á—ë–º —Ç—ã –º–µ—á—Ç–∞–µ—à—å –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö?", repeatable: true},
            {text: "–ö—Ç–æ —Ç–≤–æ–π –∏–¥–µ–∞–ª—å–Ω—ã–π –ø–∞—Ä—Ç–Ω—ë—Ä?", repeatable: true},
            {text: "–ë—ã–ª –ª–∏ —É —Ç–µ–±—è —Ä–æ–º–∞–Ω—Ç–∏—á–Ω—ã–π –º–æ–º–µ–Ω—Ç?", repeatable: false},
            {text: "–ß—Ç–æ –¥–ª—è —Ç–µ–±—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞?", repeatable: true},
            {text: "–ö–æ–≥–æ —Ç—ã —Å—á–∏—Ç–∞–µ—à—å –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–º?", repeatable: true},
            {text: "–û –∫–∞–∫–æ–º —Å–≤–∏–¥–∞–Ω–∏–∏ —Ç—ã –º–µ—á—Ç–∞–µ—à—å?", repeatable: true},
            {text: "–ß—Ç–æ —Ç–µ–±—è –≤–æ–∑–±—É–∂–¥–∞–µ—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ?", repeatable: true},
            {text: "–ö–æ–º—É —Ç—ã —Ö–æ—á–µ—à—å –ø—Ä–∏–∑–Ω–∞—Ç—å—Å—è?", repeatable: false},
            {text: "–ö–∞–∫–æ–π —Ç–≤–æ–π –∏–¥–µ–∞–ª –∫—Ä–∞—Å–æ—Ç—ã?", repeatable: true},
            {text: "–ë—ã–ª –ª–∏ —É —Ç–µ–±—è –≤–ª—é–±–ª—ë–Ω–Ω–æ—Å—Ç—å?", repeatable: false},
            {text: "–ß—Ç–æ —Ç—ã –∏—â–µ—à—å –≤ –ø–∞—Ä—Ç–Ω—ë—Ä–µ?", repeatable: true},
            {text: "–ö–∞–∫–æ–π –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç —Ç–µ–±–µ –∑–∞–ø–æ–º–Ω–∏–ª—Å—è?", repeatable: false},
            {text: "–û –∫–æ–º —Ç—ã –¥—É–º–∞–µ—à—å –ø–µ—Ä–µ–¥ —Å–Ω–æ–º?", repeatable: true}
        ],
        18: [
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–≤–æ—ë–º —Å–µ–∫—Å—É–∞–ª—å–Ω–æ–º –æ–ø—ã—Ç–µ", repeatable: false},
            {text: "–ß—Ç–æ —Ç–µ–±—è –≤–æ–∑–±—É–∂–¥–∞–µ—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ?", repeatable: true},
            {text: "–ö–∞–∫–∞—è —Ç–≤–æ—è —Å–∞–º–∞—è —Å–º–µ–ª–∞—è —Ñ–∞–Ω—Ç–∞–∑–∏—è?", repeatable: false},
            {text: "–ß—Ç–æ —Ç—ã —Ö–æ—á–µ—à—å –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤ –ø–æ—Å—Ç–µ–ª–∏?", repeatable: true},
            {text: "–ö–∞–∫–æ–π —Ç–≤–æ–π –ª—é–±–∏–º—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–∞—Ç—å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ?", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–∞–º–æ–º —Å—Ç—Ä–∞—Å—Ç–Ω–æ–º –º–æ–º–µ–Ω—Ç–µ", repeatable: false},
            {text: "–ß—Ç–æ –¥–ª—è —Ç–µ–±—è –∏–¥–µ–∞–ª—å–Ω—ã–π —Å–µ–∫—Å?", repeatable: true},
            {text: "–ö–∞–∫–∏–µ —É —Ç–µ–±—è –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è?", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–≤–æ–∏—Ö –∂–µ–ª–∞–Ω–∏—è—Ö", repeatable: true},
            {text: "–ß—Ç–æ —Ç–µ–±—è –∑–∞–≤–æ–¥–∏—Ç –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ?", repeatable: true},
            {text: "–ö–∞–∫–∞—è –ø–æ–∑–∏—Ü–∏—è —Ç–µ–±–µ –Ω—Ä–∞–≤–∏—Ç—Å—è?", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –æ —Ç–∞–π–Ω—ã—Ö –∂–µ–ª–∞–Ω–∏—è—Ö", repeatable: false},
            {text: "–ß—Ç–æ —Ç—ã –ª—é–±–∏—à—å –≤ —Å–µ–∫—Å–µ?", repeatable: true},
            {text: "–ö–∞–∫–æ–π —Ç–≤–æ–π —Ñ–µ—Ç–∏—à?", repeatable: false},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–∞–º–æ–º –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω–æ–º", repeatable: false},
            {text: "–ß—Ç–æ —Ç—ã —Ö–æ—á–µ—à—å –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–µ–≥–æ–¥–Ω—è?", repeatable: true},
            {text: "–ö–∞–∫–∞—è —Ç–≤–æ—è —ç—Ä–æ—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∞–Ω—Ç–∞–∑–∏—è?", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ —á—Ç–æ —Ç–µ–±—è –≤–æ–∑–±—É–∂–¥–∞–µ—Ç", repeatable: true},
            {text: "–ö–∞–∫–æ–π —Ç–≤–æ–π –∏–¥–µ–∞–ª –≤ –ø–æ—Å—Ç–µ–ª–∏?", repeatable: true},
            {text: "–ß—Ç–æ –¥–ª—è —Ç–µ–±—è –∑–∞–ø—Ä–µ—Ç–Ω—ã–π –ø–ª–æ–¥?", repeatable: true}
        ]
    };

    const dareTasks = {
        0: [
            {text: "–°–¥–µ–ª–∞–π 15 –æ—Ç–∂–∏–º–∞–Ω–∏–π", repeatable: true},
            {text: "–°–ø–æ–π –ø–µ—Å–Ω—é", repeatable: true},
            {text: "–¢–∞–Ω—Ü—É–π 1 –º–∏–Ω—É—Ç—É", repeatable: true},
            {text: "–ò–∑–æ–±—Ä–∞–∑–∏ –∂–∏–≤–æ—Ç–Ω–æ–µ", repeatable: true},
            {text: "–°–¥–µ–ª–∞–π –ø–ª–∞–Ω–∫—É 30 —Å–µ–∫—É–Ω–¥", repeatable: true},
            {text: "–†–∞—Å—Å–∫–∞–∂–∏ –∞–Ω–µ–∫–¥–æ—Ç", repeatable: true},
            {text: "–ü—Ä—ã–≥–∞–π –Ω–∞ –æ–¥–Ω–æ–π –Ω–æ–≥–µ", repeatable: true},
            {text: "–ò–∑–æ–±—Ä–∞–∑–∏ –∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞", repeatable: true},
            {text: "–°–¥–µ–ª–∞–π –∑–∞—Ä—è–¥–∫—É", repeatable: true},
            {text: "–ü–æ–∫–∞–∂–∏ –∞–∫—Ä–æ–±–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä—é–∫", repeatable: true},
            {text: "–ü—Ä–æ–∫—É–∫–∞—Ä–µ–∫–∞–π", repeatable: false},
            {text: "–ò–∑–æ–±—Ä–∞–∑–∏ —Ä–æ–±–æ—Ç–∞", repeatable: true},
            {text: "–°—Ç–∞–Ω—Ü—É–π –±–∞–ª–µ—Ç", repeatable: true},
            {text: "–°–¥–µ–ª–∞–π –π–æ–≥—É", repeatable: true},
            {text: "–ü–æ–∫–∞–∂–∏ –ø–∞–Ω—Ç–æ–º–∏–º—É", repeatable: true},
            {text: "–ò–∑–æ–±—Ä–∞–∑–∏ —Å—Ç–∞—Ç—É—é", repeatable: true},
            {text: "–ü—Ä—ã–≥–∞–π –∫–∞–∫ –∫–µ–Ω–≥—É—Ä—É", repeatable: true},
            {text: "–ò–∑–æ–±—Ä–∞–∑–∏ –æ–±–µ–∑—å—è–Ω—É", repeatable: true},
            {text: "–ò–∑–æ–±—Ä–∞–∑–∏ –≤–µ—Ç–µ—Ä", repeatable: true},
            {text: "–ü–æ–∫–∞–∂–∏ —Ä–∞–¥–æ—Å—Ç—å", repeatable: true}
        ],
        16: [
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} –≤ —â—ë–∫—É", repeatable: true},
            {text: "–û–±–Ω–∏–º–∏ –∏–≥—Ä–æ–∫–∞ {player} –∫—Ä–µ–ø–∫–æ", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π —Ä—É–∫—É –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–ú–∞—Å—Å–∞–∂ –ø–ª–µ—á –∏–≥—Ä–æ–∫—É {player} 2 –º–∏–Ω—É—Ç—ã", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} –≤ –ª–æ–±", repeatable: true},
            {text: "–î–µ—Ä–∂–∏—Å—å –∑–∞ —Ä—É–∫—É —Å –∏–≥—Ä–æ–∫–æ–º {player}", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –ª–∞–¥–æ–Ω—å –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–û–±–Ω–∏–º–∏ –∏–≥—Ä–æ–∫–∞ {player} —Å–∑–∞–¥–∏", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} –≤ –Ω–æ—Å", repeatable: true},
            {text: "–ü–æ–≥–ª–∞–¥—å –ø–æ –≥–æ–ª–æ–≤–µ –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} –≤ —É—Ö–æ", repeatable: true},
            {text: "–ü—Ä–∏–∂–º–∏—Å—å –∫ –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π —à–µ—é –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–û–±–Ω–∏–º–∏—Å—å —Å –∏–≥—Ä–æ–∫–æ–º {player} –ª—ë–∂–∞", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∫–ª—é—á–∏—Ü—É –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–ú–∞—Å—Å–∞–∂ —Å–ø–∏–Ω—ã –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –ø–ª–µ—á–æ –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–û–±–Ω–∏–º–∏ –∏–≥—Ä–æ–∫–∞ {player} –∑–∞ —Ç–∞–ª–∏—é", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} –≤ –≥—É–±—ã", repeatable: true},
            {text: "–°—è–¥—å –Ω–∞ –∫–æ–ª–µ–Ω–∏ –∫ –∏–≥—Ä–æ–∫—É {player}", repeatable: true}
        ],
        18: [
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} —Å—Ç—Ä–∞—Å—Ç–Ω–æ —Å —è–∑—ã–∫–æ–º", repeatable: true},
            {text: "–ú–∞—Å—Å–∞–∂ –∏–Ω—Ç–∏–º–Ω—ã–π –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} –≤–µ–∑–¥–µ", repeatable: true},
            {text: "–ü—Ä–∏–∂–º–∏—Å—å –∏–Ω—Ç–∏–º–Ω–æ –∫ –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} –¥–æ–ª–≥–æ –∏ –≥–ª—É–±–æ–∫–æ", repeatable: true},
            {text: "–û–±–Ω–∏–º–∏ –∏–≥—Ä–æ–∫–∞ {player} –≤ –ø–æ—Å—Ç–µ–ª–∏ (–∏–º–∏—Ç–∞—Ü–∏—è)", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π —ç—Ä–æ–≥–µ–Ω–Ω—ã–µ –∑–æ–Ω—ã –∏–≥—Ä–æ–∫–∞ {player}", repeatable: true},
            {text: "–ú–∞—Å—Å–∞–∂ –≤–µ–∑–¥–µ –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} —Å–æ–±–ª–∞–∑–Ω—è—é—â–µ", repeatable: true},
            {text: "–ü—Ä–∏–∂–º–∏—Å—å –≤–æ–∑–±—É–∂–¥–∞—é—â–µ –∫ –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} —á—É–≤—Å—Ç–≤–µ–Ω–Ω–æ –≤–µ–∑–¥–µ", repeatable: true},
            {text: "–û–±–Ω–∏–º–∏ –∏–≥—Ä–æ–∫–∞ {player} —Å—Ç—Ä–∞—Å—Ç–Ω–æ", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω–æ", repeatable: true},
            {text: "–ú–∞—Å—Å–∞–∂ –∏–Ω—Ç–∏–º–Ω—ã—Ö –∑–æ–Ω –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} –≥–æ—Ä—è—á–æ", repeatable: true},
            {text: "–ü—Ä–∏–∂–º–∏—Å—å —Å–µ–∫—Å—É–∞–ª—å–Ω–æ –∫ –∏–≥—Ä–æ–∫—É {player}", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} —ç—Ä–æ—Ç–∏—á–Ω–æ", repeatable: true},
            {text: "–û–±–Ω–∏–º–∏ –∏–≥—Ä–æ–∫–∞ {player} –≤–æ–∑–±—É–∂–¥–∞—é—â–µ", repeatable: true},
            {text: "–ü–æ—Ü–µ–ª—É–π –∏–≥—Ä–æ–∫–∞ {player} –¥–æ–ª–≥–æ —Å —á—É–≤—Å—Ç–≤–æ–º", repeatable: true},
            {text: "–ú–∞—Å—Å–∞–∂ —Å—Ç—Ä–∞—Å—Ç–Ω—ã–π –∏–≥—Ä–æ–∫—É {player}", repeatable: true}
        ]
    };

    let todMode = null;
    let todPlayers = [];
    let todLevel = 0;
    let todCurrentPlayer = 0;
    let todUsedTruths = [];
    let todUsedDares = [];

    function selectTODLevel(button) {
        document.querySelectorAll('#todModeSelect .level-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        button.classList.add('active');
        todLevel = parseInt(button.dataset.level);
        playClick();
    }

    function startTODDuo() {
        todMode = 'duo';
        todPlayers = ['–ò–≥—Ä–æ–∫ 1', '–ò–≥—Ä–æ–∫ 2'];
        document.getElementById('todModeSelect').style.display = 'none';
        document.getElementById('todGame').style.display = 'block';
        document.getElementById('todBottleContainer').style.display = 'none';
        todCurrentPlayer = 0;
        todUsedTruths = [];
        todUsedDares = [];
        document.getElementById('todCurrentPlayer').textContent = `${todPlayers[todCurrentPlayer]}, –≤—ã–±–µ—Ä–∏: –ü—Ä–∞–≤–¥–∞ –∏–ª–∏ –î–µ–π—Å—Ç–≤–∏–µ?`;
        document.getElementById('todTask').style.display = 'none';
        document.getElementById('todNext').style.display = 'none';
        playClick();
    }

    function startTODCompany() {
        document.getElementById('todModeSelect').style.display = 'none';
        document.getElementById('todCompanySetup').style.display = 'block';
        playClick();
    }

    function addTODPlayer() {
        const container = document.getElementById('todPlayerInputs');
        const index = container.children.length;
        const row = document.createElement('div');
        row.className = 'player-input-row';
        row.innerHTML = `
            <input type="text" class="form-input" placeholder="–ò–≥—Ä–æ–∫ ${index + 1}" data-player-index="${index}">
            <button class="remove-player" onclick="removeTODPlayer(this)">‚úï</button>
        `;
        container.appendChild(row);
        playClick();
    }

    function removeTODPlayer(button) {
        if (document.getElementById('todPlayerInputs').children.length > 2) {
            button.parentElement.remove();
            playClick();
        }
    }

    function startTODCompanyGame() {
        const inputs = document.querySelectorAll('#todPlayerInputs input');
        todPlayers = Array.from(inputs).map((input, i) => input.value.trim() || `–ò–≥—Ä–æ–∫ ${i + 1}`);
        
        todMode = 'company';
        document.getElementById('todCompanySetup').style.display = 'none';
        document.getElementById('todGame').style.display = 'block';
        document.getElementById('todBottleContainer').style.display = 'block';
        todUsedTruths = [];
        todUsedDares = [];
        updateTODPlayers();
        document.getElementById('todCurrentPlayer').textContent = '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –±—É—Ç—ã–ª–æ—á–∫—É';
        document.getElementById('todTask').style.display = 'none';
        document.getElementById('todNext').style.display = 'none';
        playClick();
    }

    function updateTODPlayers() {
        const circle = document.getElementById('todPlayersCircle');
        circle.innerHTML = '';
        
        const radius = 140;
        const angleStep = (2 * Math.PI) / todPlayers.length;
        
        todPlayers.forEach((player, index) => {
            const angle = index * angleStep - Math.PI / 2;
            const x = radius * Math.cos(angle);
            const y = radius * Math.sin(angle);
            
            const marker = document.createElement('div');
            marker.className = 'player-marker';
            marker.textContent = player;
            marker.style.left = `calc(50% + ${x}px)`;
            marker.style.top = `calc(50% + ${y}px)`;
            marker.style.transform = 'translate(-50%, -50%)';
            marker.dataset.index = index;
            
            if (index === todCurrentPlayer && todMode === 'company') {
                marker.classList.add('selected');
            }
            
            circle.appendChild(marker);
        });
    }

    function spinTODBottle() {
        const bottle = document.getElementById('todBottle');
        const rotations = 360 * 8 + Math.random() * 360;
        bottle.style.transform = `translate(-12.5px, -12.5px) rotate(${rotations}deg)`;
        bottle.classList.add('spinning');
        playSpin();
        
        setTimeout(() => {
            bottle.classList.remove('spinning');
            
            const finalAngle = rotations % 360;
            const angleStep = 360 / todPlayers.length;
            todCurrentPlayer = Math.floor((finalAngle + angleStep / 2) / angleStep) % todPlayers.length;
            
            updateTODPlayers();
            document.getElementById('todCurrentPlayer').textContent = `${todPlayers[todCurrentPlayer]}, –≤—ã–±–µ—Ä–∏: –ü—Ä–∞–≤–¥–∞ –∏–ª–∏ –î–µ–π—Å—Ç–≤–∏–µ?`;
            document.getElementById('todTask').style.display = 'none';
            document.getElementById('todNext').style.display = 'none';
            playSuccess();
        }, 5000);
    }

    function chooseTruth() {
        const task = getTODTask(truthTasks[todLevel], todUsedTruths);
        document.getElementById('todTask').textContent = task;
        document.getElementById('todTask').style.display = 'block';
        document.getElementById('todNext').style.display = 'block';
        playClick();
        addToHistory('–ü—Ä–∞–≤–¥–∞/–î–µ–π—Å—Ç–≤–∏–µ', `${todPlayers[todCurrentPlayer]} - –ü—Ä–∞–≤–¥–∞: ${task.substring(0, 50)}...`);
    }

    function chooseDare() {
        const task = getTODTask(dareTasks[todLevel], todUsedDares);
        document.getElementById('todTask').textContent = task;
        document.getElementById('todTask').style.display = 'block';
        document.getElementById('todNext').style.display = 'block';
        playClick();
        addToHistory('–ü—Ä–∞–≤–¥–∞/–î–µ–π—Å—Ç–≤–∏–µ', `${todPlayers[todCurrentPlayer]} - –î–µ–π—Å—Ç–≤–∏–µ: ${task.substring(0, 50)}...`);
    }

    function getTODTask(tasks, usedTasks) {
        const availableTasks = tasks.filter(task => 
            !usedTasks.includes(task.text) || task.repeatable
        );
        
        if (availableTasks.length === 0) {
            usedTasks.length = 0;
            return getTODTask(tasks, usedTasks);
        }
        
        const task = availableTasks[Math.floor(Math.random() * availableTasks.length)];
        
        if (!task.repeatable) {
            usedTasks.push(task.text);
        }
        
        if (task.text.includes('{player}') && todPlayers.length > 1) {
            let targetPlayer = todPlayers[Math.floor(Math.random() * todPlayers.length)];
            while (targetPlayer === todPlayers[todCurrentPlayer]) {
                targetPlayer = todPlayers[Math.floor(Math.random() * todPlayers.length)];
            }
            return task.text.replace('{player}', targetPlayer);
        }
        
        return task.text;
    }

    function nextTODTurn() {
        if (todMode === 'duo') {
            todCurrentPlayer = (todCurrentPlayer + 1) % 2;
            document.getElementById('todCurrentPlayer').textContent = `${todPlayers[todCurrentPlayer]}, –≤—ã–±–µ—Ä–∏: –ü—Ä–∞–≤–¥–∞ –∏–ª–∏ –î–µ–π—Å—Ç–≤–∏–µ?`;
        } else {
            document.getElementById('todCurrentPlayer').textContent = '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –±—É—Ç—ã–ª–æ—á–∫—É';
            updateTODPlayers();
        }
        document.getElementById('todTask').style.display = 'none';
        document.getElementById('todNext').style.display = 'none';
        playClick();
    }

    function backToTODMode() {
        document.getElementById('todGame').style.display = 'none';
        document.getElementById('todModeSelect').style.display = 'block';
        document.getElementById('todBottle').style.transform = 'translate(-12.5px, -12.5px) rotate(0deg)';
        playClick();
    }

    // ===== MINI GAMES =====
    const miniGames = [
        {icon: '‚úÇÔ∏è', title: '–ö–∞–º–µ–Ω—å-–Ω–æ–∂–Ω–∏—Ü—ã-–±—É–º–∞–≥–∞', id: 'rps'},
        {icon: 'üéØ', title: '–†—É–ª–µ—Ç–∫–∞', id: 'roulette'},
        {icon: 'üé≤', title: '–ö–æ—Å—Ç–∏', id: 'dice'},
        {icon: 'üß†', title: '–ü–∞–º—è—Ç—å', id: 'memory'},
        {icon: '‚ö°', title: '–†–µ–∞–∫—Ü–∏—è', id: 'reaction'},
        {icon: 'üìö', title: '–í–∏–∫—Ç–æ—Ä–∏–Ω–∞', id: 'quiz'},
        {icon: 'üé®', title: '–†–∏—Å—É–Ω–æ–∫ –≤—Å–ª–µ–ø—É—é', id: 'draw'},
        {icon: 'üé§', title: '–ö–∞—Ä–∞–æ–∫–µ-—á–µ–ª–ª–µ–Ω–¥–∂', id: 'karaoke'},
        {icon: 'üíÉ', title: '–¢–∞–Ω—Ü—É–π –∫–∞–∫...', id: 'dance'},
        {icon: 'üé≠', title: '–ê–∫—Ç—ë—Ä—Å–∫–∞—è –∏–≥—Ä–∞', id: 'acting'},
        {icon: 'üî¢', title: '–ë—ã—Å—Ç—Ä—ã–π —Å—á—ë—Ç', id: 'math'},
        {icon: 'üìù', title: '–í–∏—Å–µ–ª–∏—Ü–∞', id: 'hangman'},
        {icon: 'üé™', title: '–§–∞–Ω—Ç—ã', id: 'forfeits'},
        {icon: 'üèÉ', title: '–¢–∞–π–º–µ—Ä-—á–µ–ª–ª–µ–Ω–¥–∂', id: 'timer'},
        {icon: 'üéØ', title: '–î–∞—Ä—Ç—Å (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π)', id: 'darts'},
        {icon: 'üé∞', title: '–°–ª–æ—Ç-–º–∞—à–∏–Ω–∞', id: 'slots'},
        {icon: 'üÉè', title: '–£–≥–∞–¥–∞–π –∫–∞—Ä—Ç—É', id: 'card'},
        {icon: 'üéµ', title: '–£–≥–∞–¥–∞–π –º–µ–ª–æ–¥–∏—é', id: 'melody'},
        {icon: 'üåç', title: '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', id: 'geo'},
        {icon: 'üí≠', title: '–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏', id: 'association'},
        {icon: 'üî§', title: '–ê–Ω–∞–≥—Ä–∞–º–º—ã', id: 'anagram'},
        {icon: 'üé¨', title: '–£–≥–∞–¥–∞–π —Ñ–∏–ª—å–º', id: 'movie'},
        {icon: 'üçï', title: '–ï–¥–∞ –∏–ª–∏ –Ω–µ –µ–¥–∞', id: 'food'},
        {icon: '‚è±Ô∏è', title: '–°—Ç–æ–ø-—Å–µ–∫—É–Ω–¥–∞', id: 'stopwatch'},
        {icon: 'üé≤', title: '–ö—É–±–∏–∫ —É–¥–∞—á–∏', id: 'lucky'}
    ];

    function initMiniGames() {
        const grid = document.getElementById('miniGamesGrid');
        miniGames.forEach(game => {
            const card = document.createElement('div');
            card.className = 'mini-game-card';
            card.onclick = () => openMiniGame(game);
            card.innerHTML = `
                <div class="mini-game-icon">${game.icon}</div>
                <div class="mini-game-title">${game.title}</div>
            `;
            grid.appendChild(card);
        });
    }

    function openMiniGame(game) {
        const modal = document.getElementById('miniGameModal');
        document.getElementById('miniGameTitle').textContent = game.icon + ' ' + game.title;
        
        let content = '';
        switch(game.id) {
            case 'rps':
                content = `
                    <div style="text-align: center;">
                        <div style="font-size: 4rem; margin: 30px 0;">
                            <span id="rpsChoice">‚ùì</span>
                        </div>
                        <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                            <button class="btn" onclick="playRPS('‚úä')">‚úä –ö–∞–º–µ–Ω—å</button>
                            <button class="btn" onclick="playRPS('‚úã')">‚úã –ë—É–º–∞–≥–∞</button>
                            <button class="btn" onclick="playRPS('‚úåÔ∏è')">‚úåÔ∏è –ù–æ–∂–Ω–∏—Ü—ã</button>
                        </div>
                        <div id="rpsResult" style="margin-top: 30px; font-size: 1.3rem;"></div>
                    </div>
                `;
                break;
            case 'roulette':
                content = `
                    <div style="text-align: center;">
                        <div style="font-size: 5rem; margin: 30px 0;" id="rouletteNumber">0</div>
                        <button class="btn" onclick="spinRoulette()">üé∞ –ö—Ä—É—Ç–∏—Ç—å</button>
                        <div id="rouletteResult" style="margin-top: 20px; font-size: 1.2rem;"></div>
                    </div>
                `;
                break;
            case 'dice':
                content = `
                    <div style="text-align: center;">
                        <div style="font-size: 4rem; margin: 30px 0; display: flex; gap: 20px; justify-content: center;">
                            <span id="dice1">üé≤</span>
                            <span id="dice2">üé≤</span>
                        </div>
                        <button class="btn" onclick="rollDice()">üé≤ –ë—Ä–æ—Å–∏—Ç—å</button>
                        <div id="diceResult" style="margin-top: 20px; font-size: 1.2rem;"></div>
                    </div>
                `;
                break;
            default:
                content = '<p style="text-align: center; color: var(--text-secondary);">–°–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è!</p>';
        }
        
        document.getElementById('miniGameContent').innerHTML = content;
        modal.classList.add('active');
        playClick();
    }

    function closeMiniGame() {
        document.getElementById('miniGameModal').classList.remove('active');
        playClick();
    }

    // Mini game implementations
    function playRPS(choice) {
        const choices = ['‚úä', '‚úã', '‚úåÔ∏è'];
        const computer = choices[Math.floor(Math.random() * 3)];
        document.getElementById('rpsChoice').textContent = computer;
        
        let result = '';
        if (choice === computer) {
            result = '–ù–∏—á—å—è!';
        } else if (
            (choice === '‚úä' && computer === '‚úåÔ∏è') ||
            (choice === '‚úã' && computer === '‚úä') ||
            (choice === '‚úåÔ∏è' && computer === '‚úã')
        ) {
            result = 'üéâ –í—ã –ø–æ–±–µ–¥–∏–ª–∏!';
            playSuccess();
        } else {
            result = 'üòî –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!';
            playError();
        }
        
        document.getElementById('rpsResult').textContent = `–ö–æ–º–ø—å—é—Ç–µ—Ä: ${computer} | ${result}`;
        addToHistory('–ö–∞–º–µ–Ω—å-–Ω–æ–∂–Ω–∏—Ü—ã-–±—É–º–∞–≥–∞', result);
    }

    function spinRoulette() {
        let counter = 0;
        const interval = setInterval(() => {
            document.getElementById('rouletteNumber').textContent = Math.floor(Math.random() * 37);
            counter++;
            if (counter > 20) {
                clearInterval(interval);
                const final = Math.floor(Math.random() * 37);
                document.getElementById('rouletteNumber').textContent = final;
                let result = final === 0 ? '–ó–µ—Ä–æ!' : (final % 2 === 0 ? '–ß—ë—Ç–Ω–æ–µ' : '–ù–µ—á—ë—Ç–Ω–æ–µ');
                document.getElementById('rouletteResult').textContent = result;
                playSuccess();
                addToHistory('–†—É–ª–µ—Ç–∫–∞', `–í—ã–ø–∞–ª–æ: ${final} - ${result}`);
            }
        }, 100);
        playSpin();
    }

    function rollDice() {
        const diceEmojis = ['‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'];
        const dice1 = Math.floor(Math.random() * 6);
        const dice2 = Math.floor(Math.random() * 6);
        
        document.getElementById('dice1').textContent = diceEmojis[dice1];
        document.getElementById('dice2').textContent = diceEmojis[dice2];
        
        const sum = dice1 + dice2 + 2;
        let result = `–°—É–º–º–∞: ${sum}`;
        if (sum === 2) result += ' - –ó–º–µ–∏–Ω—ã–µ –≥–ª–∞–∑–∞!';
        else if (sum === 12) result += ' - –ë–æ–∫—Å—ë—Ä—Å–∫–∏–µ!';
        else if (dice1 === dice2) result += ' - –î—É–±–ª—å!';
        
        document.getElementById('diceResult').textContent = result;
        playSuccess();
        addToHistory('–ö–æ—Å—Ç–∏', result);
    }
</script>
```

</body>
</html>
