<!DOCTYPE html>

<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Party Games</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#0a0a0f;--surface:#141419;--accent:#6366f1;--text:#fff;--dim:#9ca3af;--border:rgba(255,255,255,.08);
--success:#10b981;--danger:#ef4444;--warning:#f59e0b
}
body.theme-purple{--accent:#a855f7}
body.theme-red{--accent:#ef4444}
body.theme-green{--accent:#10b981}
body.theme-blue{--accent:#3b82f6}
body{font-family:'Inter',-apple-system,sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden;min-height:100vh}
.bg-animated{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;overflow:hidden}
.bg-gradient{position:absolute;width:100%;height:100%;background:radial-gradient(circle at 20% 30%,rgba(99,102,241,.15) 0%,transparent 50%),radial-gradient(circle at 80% 70%,rgba(124,58,237,.12) 0%,transparent 50%);animation:gradientShift 20s ease infinite}
@keyframes gradientShift{0%,100%{transform:translate(0,0) scale(1)}33%{transform:translate(5%,-5%) scale(1.05)}66%{transform:translate(-5%,5%) scale(.95)}}
.particle{position:absolute;width:3px;height:3px;background:rgba(255,255,255,.4);border-radius:50%;animation:particleFloat 15s linear infinite}
@keyframes particleFloat{0%{transform:translateY(100vh) translateX(0);opacity:0}10%{opacity:1}90%{opacity:1}100%{transform:translateY(-100vh) translateX(100px);opacity:0}}
.floating-shape{position:absolute;border-radius:50%;opacity:.1;animation:floatShape 20s ease-in-out infinite}
@keyframes floatShape{0%,100%{transform:translate(0,0) rotate(0deg)}25%{transform:translate(50px,-50px) rotate(90deg)}50%{transform:translate(-30px,60px) rotate(180deg)}75%{transform:translate(40px,30px) rotate(270deg)}}
.container{position:relative;z-index:1;max-width:1200px;margin:0 auto;padding:20px;min-height:100vh}
.auth-screen{display:flex;align-items:center;justify-content:center;min-height:100vh;text-align:center}
.auth-box{background:var(--surface);border:1px solid var(--border);border-radius:24px;padding:60px 40px;max-width:480px;width:100%;animation:fadeInUp .6s ease}
@keyframes fadeInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
.auth-icon{font-size:72px;margin-bottom:24px;animation:bounce 2s ease infinite}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
.auth-title{font-size:32px;font-weight:800;margin-bottom:12px;background:linear-gradient(135deg,var(--accent),#ec4899);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.auth-desc{color:var(--dim);margin-bottom:32px;line-height:1.6}
.btn{background:var(--accent);color:#fff;border:none;padding:16px 32px;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;transition:all .3s ease;display:inline-flex;align-items:center;gap:10px;position:relative;overflow:hidden}
.btn::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;background:rgba(255,255,255,.2);border-radius:50%;transform:translate(-50%,-50%);transition:width .6s,height .6s}
.btn:hover::before{width:300px;height:300px}
.btn:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(99,102,241,.4)}
.btn:active{transform:translateY(0)}
header{display:flex;justify-content:space-between;align-items:center;padding:20px;background:rgba(20,20,25,.8);backdrop-filter:blur(20px);border:1px solid var(--border);border-radius:16px;margin-bottom:24px;animation:slideDown .5s ease}
@keyframes slideDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
.logo{display:flex;align-items:center;gap:12px;font-size:20px;font-weight:800}
.logo-icon{width:40px;height:40px;background:linear-gradient(135deg,var(--accent),#ec4899);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px}
.user-info{display:flex;align-items:center;gap:12px;padding:8px 16px;background:var(--surface);border-radius:12px;cursor:pointer;transition:all .3s ease}
.user-info:hover{background:rgba(99,102,241,.1)}
.user-avatar{width:32px;height:32px;background:linear-gradient(135deg,var(--accent),#ec4899);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px}
.nav{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px;margin-bottom:24px;animation:fadeIn .6s ease .2s both}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.nav-btn{padding:14px 20px;background:var(--surface);border:1px solid var(--border);border-radius:12px;color:var(--dim);font-weight:600;cursor:pointer;transition:all .3s ease;text-align:center;font-size:14px}
.nav-btn:hover{border-color:var(--accent);color:var(--text);transform:translateY(-2px)}
.nav-btn.active{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 0 30px rgba(99,102,241,.3)}
.games-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:16px;animation:fadeIn .8s ease .4s both}
.game-card{aspect-ratio:1;background:var(--surface);border:1px solid var(--border);border-radius:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;cursor:pointer;transition:all .4s cubic-bezier(.34,1.56,.64,1);position:relative;overflow:hidden}
.game-card::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,rgba(99,102,241,.1),rgba(124,58,237,.1));opacity:0;transition:opacity .3s ease}
.game-card:hover::before{opacity:1}
.game-card:hover{transform:translateY(-8px);border-color:var(--accent);box-shadow:0 20px 40px rgba(0,0,0,.4)}
.game-icon{font-size:48px;z-index:1;transition:transform .3s ease}
.game-card:hover .game-icon{transform:scale(1.1) rotate(5deg)}
.game-name{font-weight:600;font-size:14px;z-index:1}
.game-badge{position:absolute;top:12px;right:12px;padding:4px 10px;background:var(--success);border-radius:6px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.5px}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);backdrop-filter:blur(10px);display:none;align-items:center;justify-content:center;z-index:1000;padding:20px}
.modal.active{display:flex;animation:fadeIn .3s ease}
.modal-content{background:var(--surface);border:1px solid var(--border);border-radius:20px;max-width:800px;width:100%;max-height:90vh;overflow-y:auto;padding:32px;animation:scaleIn .4s cubic-bezier(.34,1.56,.64,1)}
@keyframes scaleIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
.modal-title{font-size:28px;font-weight:800}
.close-btn{width:40px;height:40px;border-radius:50%;background:rgba(255,255,255,.05);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease;font-size:20px}
.close-btn:hover{background:var(--danger);border-color:var(--danger);transform:rotate(90deg)}
.chat-container{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:20px;max-height:500px;overflow-y:auto;margin-bottom:16px}
.chat-message{display:flex;gap:12px;margin-bottom:16px;animation:slideInLeft .4s ease}
@keyframes slideInLeft{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}
.chat-avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--accent),#ec4899);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px;flex-shrink:0}
.chat-content{flex:1}
.chat-header{display:flex;align-items:center;gap:8px;margin-bottom:4px}
.chat-username{font-weight:600;font-size:14px}
.chat-time{font-size:12px;color:var(--dim)}
.chat-text{font-size:14px;line-height:1.5}
.chat-text.deleted{color:var(--dim);font-style:italic}
.chat-input-container{display:flex;gap:12px}
.chat-input{flex:1;padding:14px 18px;background:rgba(255,255,255,.05);border:1px solid var(--border);border-radius:12px;color:var(--text);font-size:14px;outline:0;transition:all .3s ease}
.chat-input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(99,102,241,.1)}
.history-item{display:flex;justify-content:space-between;align-items:center;padding:16px;background:var(--surface);border:1px solid var(--border);border-radius:12px;margin-bottom:12px;transition:all .3s ease;animation:fadeIn .4s ease}
.history-item:hover{border-color:var(--accent);transform:translateX(4px)}
.history-info{display:flex;flex-direction:column;gap:4px}
.history-user{font-weight:600;font-size:15px}
.history-game{font-size:13px;color:var(--dim)}
.history-time{font-size:12px;color:var(--dim)}
.admin-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin-bottom:24px}
.admin-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:24px;transition:all .3s ease}
.admin-card:hover{transform:translateY(-4px);border-color:var(--accent)}
.admin-card-title{font-size:14px;color:var(--dim);margin-bottom:12px}
.admin-card-value{font-size:36px;font-weight:800;background:linear-gradient(135deg,var(--accent),#ec4899);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.settings-section{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:24px;margin-bottom:20px}
.settings-title{font-size:18px;font-weight:700;margin-bottom:16px}
.switch-label{display:flex;align-items:center;justify-content:space-between;padding:16px;background:rgba(255,255,255,.03);border-radius:12px;margin-bottom:12px;cursor:pointer;transition:all .3s ease}
.switch-label:hover{background:rgba(255,255,255,.05)}
.switch{position:relative;width:52px;height:28px}
.switch input{display:none}
.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:rgba(255,255,255,.05);border:1px solid var(--border);transition:.3s;border-radius:14px}
.slider:before{position:absolute;content:"";height:20px;width:20px;left:3px;bottom:3px;background:var(--dim);transition:.3s;border-radius:50%}
input:checked+.slider{background:var(--accent);border-color:var(--accent)}
input:checked+.slider:before{transform:translateX(24px);background:#fff}
.toast-container{position:fixed;top:20px;right:20px;z-index:2000;display:flex;flex-direction:column;gap:12px}
.toast{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px 20px;min-width:300px;display:flex;align-items:center;gap:12px;box-shadow:0 10px 30px rgba(0,0,0,.5);animation:slideInRight .3s ease}
@keyframes slideInRight{from{opacity:0;transform:translateX(100px)}to{opacity:1;transform:translateX(0)}}
.toast.success{border-color:var(--success)}
.toast.error{border-color:var(--danger)}
.toast-icon{font-size:24px}
.toast-text{flex:1;font-weight:600;font-size:14px}
.hidden{display:none!important}
.btn-secondary{background:rgba(255,255,255,.05);color:var(--text);border:1px solid var(--border)}
.btn-secondary:hover{border-color:var(--accent);box-shadow:0 10px 30px rgba(99,102,241,.2)}
.ttt-board{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;max-width:400px;margin:20px auto}
.ttt-cell{aspect-ratio:1;background:rgba(255,255,255,.03);border:2px solid var(--border);border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:48px;font-weight:700;cursor:pointer;transition:all .3s ease}
.ttt-cell:hover:not(.filled){background:rgba(99,102,241,.1);border-color:var(--accent);transform:scale(1.05)}
.ttt-cell.filled{cursor:not-allowed}
.ttt-cell.x{color:#ef4444;animation:popIn .4s cubic-bezier(.34,1.56,.64,1)}
.ttt-cell.o{color:#3b82f6;animation:popIn .4s cubic-bezier(.34,1.56,.64,1)}
@keyframes popIn{0%{transform:scale(0);opacity:0}100%{transform:scale(1);opacity:1}}
.card{width:180px;height:260px;background:linear-gradient(135deg,rgba(255,255,255,.05),rgba(255,255,255,.02));border:2px solid var(--border);border-radius:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .4s ease;box-shadow:0 10px 40px rgba(0,0,0,.4);position:relative;overflow:hidden;margin:10px}
.card:hover{transform:translateY(-10px) scale(1.05) rotate(2deg);box-shadow:0 20px 60px rgba(99,102,241,.3);z-index:10}
.card-rank{font-size:72px;font-weight:800;background:linear-gradient(135deg,var(--accent),#ec4899);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.card-suit{font-size:36px;margin-top:-10px}
.card-effect{position:absolute;bottom:20px;left:0;right:0;text-align:center;font-size:12px;font-weight:600;padding:0 15px;color:var(--dim);line-height:1.4}
.cards-deck{display:flex;justify-content:center;align-items:center;min-height:400px;flex-wrap:wrap;gap:20px;padding:20px}
.player-chip{padding:10px 18px;background:rgba(255,255,255,.05);border:1px solid var(--border);border-radius:20px;font-weight:600;font-size:14px;display:flex;align-items:center;gap:8px;transition:all .3s ease}
.player-chip.active{background:var(--accent);border-color:var(--accent);box-shadow:0 0 30px rgba(99,102,241,.3);animation:pulse 1.5s infinite;transform:scale(1.05)}
.players-list{display:flex;flex-wrap:wrap;gap:10px;margin:20px 0;justify-content:center}
.theme-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:12px;margin:20px 0}
.theme-btn{padding:16px;border-radius:12px;border:2px solid var(--border);background:rgba(255,255,255,.03);cursor:pointer;transition:all .3s ease;font-weight:600;font-size:14px;text-align:center}
.theme-btn:hover{transform:translateY(-3px);box-shadow:0 10px 25px rgba(0,0,0,.3)}
.theme-btn.active{border-color:var(--accent);background:rgba(99,102,241,.1)}
::-webkit-scrollbar{width:8px;height:8px}
::-webkit-scrollbar-track{background:var(--surface)}
::-webkit-scrollbar-thumb{background:var(--accent);border-radius:4px}
@media(max-width:768px){
.auth-box{padding:40px 24px}
.games-grid{grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:12px}
.game-icon{font-size:36px}
.modal-content{padding:24px}
.toast{min-width:auto;max-width:calc(100vw - 40px)}
}
</style>
</head>
<body>
<div class="bg-animated">
<div class="bg-gradient"></div>
<div id="particles"></div>
<div id="shapes"></div>
</div>

<div id="authScreen" class="auth-screen">
<div class="auth-box">
<div class="auth-icon">üéÆ</div>
<h1 class="auth-title">Party Games</h1>
<p class="auth-desc">–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ Telegram –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã</p>
<button class="btn" onclick="initAuth()">
<span>üì±</span>
<span>–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram</span>
</button>
</div>
</div>

<div id="mainApp" class="container hidden">
<header>
<div class="logo">
<div class="logo-icon">üéÆ</div>
<span>PARTY GAMES</span>
</div>
<div class="user-info" id="userInfo">
<div class="user-avatar" id="userAvatar">?</div>
<span id="userName">User</span>
</div>
</header>

<div class="nav">
<button class="nav-btn active" data-section="games">üéØ –ò–≥—Ä—ã</button>
<button class="nav-btn" data-section="chat">üí¨ –ß–∞—Ç</button>
<button class="nav-btn" data-section="history">üìä –ò—Å—Ç–æ—Ä–∏—è</button>
<button class="nav-btn" data-section="settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
<button class="nav-btn hidden" data-section="admin" id="adminBtn">üëë –ê–¥–º–∏–Ω</button>
</div>

<div id="gamesSection" class="content">
<div class="games-grid" id="gamesGrid"></div>
</div>

<div id="chatSection" class="content hidden">
<div class="chat-container" id="chatMessages"></div>
<div class="chat-input-container">
<input type="text" class="chat-input" id="chatInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
<button class="btn" onclick="sendMessage()">üì§</button>
</div>
</div>

<div id="historySection" class="content hidden">
<div style="margin-bottom:20px;display:flex;gap:12px;flex-wrap:wrap">
<button class="btn btn-secondary" onclick="clearHistory()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
<button class="btn btn-secondary" onclick="exportHistory()">üì• –≠–∫—Å–ø–æ—Ä—Ç</button>
</div>
<div id="historyList"></div>
</div>

<div id="settingsSection" class="content hidden">
<div class="settings-section">
<div class="settings-title">üé® –¢–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</div>
<div class="theme-grid">
<div class="theme-btn active" onclick="setTheme('default')">üåô –¢—ë–º–Ω–∞—è</div>
<div class="theme-btn" onclick="setTheme('purple')">üíú –§–∏–æ–ª–µ—Ç</div>
<div class="theme-btn" onclick="setTheme('blue')">üíô –°–∏–Ω—è—è</div>
<div class="theme-btn" onclick="setTheme('green')">üíö –ó–µ–ª—ë–Ω–∞—è</div>
<div class="theme-btn" onclick="setTheme('red')">‚ù§Ô∏è –ö—Ä–∞—Å–Ω–∞—è</div>
</div>
</div>

<div class="settings-section">
<div class="settings-title">üîä –ó–≤—É–∫ –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã</div>
<label class="switch-label">
<span>–ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</span>
<div class="switch">
<input type="checkbox" id="soundToggle" checked onchange="toggleSound()">
<span class="slider"></span>
</div>
</label>
<label class="switch-label">
<span>–í–∏–±—Ä–∞—Ü–∏—è</span>
<div class="switch">
<input type="checkbox" id="vibrationToggle" checked onchange="toggleVibration()">
<span class="slider"></span>
</div>
</label>
</div>
</div>

<div id="adminSection" class="content hidden">
<div class="admin-grid">
<div class="admin-card">
<div class="admin-card-title">üë• –û–Ω–ª–∞–π–Ω</div>
<div class="admin-card-value" id="adminOnline">0</div>
</div>
<div class="admin-card">
<div class="admin-card-title">üí¨ –°–æ–æ–±—â–µ–Ω–∏—è</div>
<div class="admin-card-value" id="adminMessages">0</div>
</div>
<div class="admin-card">
<div class="admin-card-title">üéÆ –ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ</div>
<div class="admin-card-value" id="adminGames">0</div>
</div>
</div>

<div class="settings-section">
<div class="settings-title">ü§ñ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞–º–∏</div>
<label class="switch-label">
<span>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–≥—Ä–æ–≤–æ–π –∏—Å—Ç–æ—Ä–∏–∏</span>
<div class="switch">
<input type="checkbox" id="botsToggle" onchange="toggleBots()">
<span class="slider"></span>
</div>
</label>
<p style="color:var(--dim);font-size:13px;margin-top:12px">
–ë–æ—Ç—ã –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä–æ–≤—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∞–∂–¥—ã–µ 3-8 —Å–µ–∫—É–Ω–¥
</p>
</div>

<div style="display:flex;gap:12px;flex-wrap:wrap">
<button class="btn btn-secondary" onclick="clearAllData()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
<button class="btn btn-secondary" onclick="exportAllData()">üíæ –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</button>
</div>
</div>
</div>

<div id="gameModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h2 class="modal-title" id="modalTitle">–ò–≥—Ä–∞</h2>
<div class="close-btn" onclick="closeModal()">‚úï</div>
</div>
<div id="modalBody"></div>
</div>
</div>

<div class="toast-container" id="toastContainer"></div>

<script>
const CONFIG={admin:'mrztn'};
let state={user:null,auth:false,settings:{sound:1,vib:1,theme:'default'},bots:0,botInt:null};
const GAMES=[
{id:'bottle',name:'–ë—É—Ç—ã–ª–æ—á–∫–∞',icon:'üçæ',badge:'HOT'},
{id:'truth',name:'–ü—Ä–∞–≤–¥–∞/–î–µ–π—Å—Ç–≤–∏–µ',icon:'ü§î'},
{id:'seven',name:'–°–µ–º—ë—Ä–æ—á–∫–∞',icon:'üé¥',badge:'NEW'},
{id:'ttt',name:'–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏',icon:'‚ùå'},
{id:'dare',name:'–Ø –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ',icon:'üôä'},
{id:'mafia',name:'–ú–∞—Ñ–∏—è',icon:'üïµÔ∏è'},
{id:'alias',name:'–ê–ª–∏–∞—Å',icon:'üí¨'},
{id:'crocodile',name:'–ö—Ä–æ–∫–æ–¥–∏–ª',icon:'ü¶é'},
{id:'cities',name:'–ì–æ—Ä–æ–¥–∞',icon:'üèôÔ∏è'},
{id:'association',name:'–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏',icon:'üß†'}
];
const BOTS=['andreygay','–†–æ–º–∞','–õ–µ–Ω–∞','–ü–æ–ª–∏–Ω–∞','kukold','–ú–∞–∫—Å','–ö–∞—Ç—è','–î–∏–º–∞','–°–∞—à–∞','–û–ª—è','–í–ª–∞–¥','–ú–∞—Ä–∏—è','–ê—Ä—Ç—ë–º','–ù–∞—Å—Ç—è'];
let tg=null;
if(window.Telegram&&window.Telegram.WebApp){
tg=window.Telegram.WebApp;
try{tg.expand();tg.enableClosingConfirmation()}catch(e){}
}

function initAuth(){
if(tg&&tg.initDataUnsafe&&tg.initDataUnsafe.user){
const u=tg.initDataUnsafe.user;
auth({id:u.id,username:u.username||'User',firstName:u.first_name||'User',phone:u.phone_number||null});
}else{
auth({id:Date.now(),username:'mrztn',firstName:'Test',phone:'+79991234567'});
}
}

function auth(u){
state.user=u;
state.auth=1;
localStorage.setItem('user',JSON.stringify(u));
$('authScreen').classList.add('hidden');
$('mainApp').classList.remove('hidden');
init();
playSound('login');
toast('‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞','success');
}

function init(){
$('userName').textContent=state.user.username;
$('userAvatar').textContent=state.user.firstName.charAt(0).toUpperCase();
if(state.user.username===CONFIG.admin){
$('adminBtn').classList.remove('hidden');
}
renderGames();
loadSettings();
loadChat();
loadHistory();
createParticles();
createShapes();
setupNav();
}

function createParticles(){
const c=$('particles');
for(let i=0;i<30;i++){
const p=document.createElement('div');
p.className='particle';
p.style.left=Math.random()*100+'%';
p.style.animationDelay=Math.random()*15+'s';
p.style.animationDuration=(15+Math.random()*10)+'s';
c.appendChild(p);
}
}

function createShapes(){
const c=$('shapes');
const shapes=['circle','square','triangle'];
for(let i=0;i<10;i++){
const s=document.createElement('div');
s.className='floating-shape';
s.style.width=Math.random()*200+100+'px';
s.style.height=s.style.width;
s.style.left=Math.random()*100+'%';
s.style.top=Math.random()*100+'%';
s.style.background=`linear-gradient(135deg,rgba(99,102,241,${Math.random()*.1}),rgba(124,58,237,${Math.random()*.1}))`;
s.style.animationDelay=Math.random()*20+'s';
c.appendChild(s);
}
}

function setupNav(){
$$('.nav-btn').forEach(b=>{
b.addEventListener('click',()=>{
const sec=b.dataset.section;
$$('.nav-btn').forEach(x=>x.classList.remove('active'));
b.classList.add('active');
$$('.content').forEach(x=>x.classList.add('hidden'));
$(sec+'Section').classList.remove('hidden');
playSound('click');
if(sec==='history')renderHistory();
if(sec==='admin')updateAdmin();
});
});
}

function renderGames(){
$('gamesGrid').innerHTML=GAMES.map(g=>`
<div class="game-card" onclick="openGame('${g.id}')">
${g.badge?`<div class="game-badge">${g.badge}</div>`:''}
<div class="game-icon">${g.icon}</div>
<div class="game-name">${g.name}</div>
</div>
`).join('');
}

function openGame(id){
const g=GAMES.find(x=>x.id===id);
if(!g)return;
$('modalTitle').textContent=g.icon+' '+g.name;
$('gameModal').classList.add('active');
addHistory(g.name);
playSound('open');
const body=$('modalBody');
switch(id){
case 'bottle':initBottle(body);break;
case 'truth':initTruth(body);break;
case 'seven':initSeven(body);break;
case 'ttt':initTTT(body);break;
case 'dare':initDare(body);break;
case 'mafia':initMafia(body);break;
case 'alias':initAlias(body);break;
case 'crocodile':initCroc(body);break;
case 'cities':initCities(body);break;
case 'association':initAssoc(body);break;
}
}

function closeModal(){
$('gameModal').classList.remove('active');
playSound('close');
}

function initBottle(c){
let age='16+',spin=0;
const t16=['–†–∞—Å—Å–∫–∞–∂–∏ –∞–Ω–µ–∫–¥–æ—Ç','–°–ø–æ–π –ø–µ—Å–Ω—é','–°—Ç–∞–Ω—Ü—É–π 30 —Å–µ–∫','–ò–∑–æ–±—Ä–∞–∑–∏ –∂–∏–≤–æ—Ç–Ω–æ–µ','–ö–æ–º–ø–ª–∏–º–µ–Ω—Ç –∫–æ–º—É-—Ç–æ','–ü–æ–∫–∞–∂–∏ —Ç–∞–ª–∞–Ω—Ç','10 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π','–°–∫–æ—Ä–æ–≥–æ–≤–æ—Ä–∫–∞ 3 —Ä–∞–∑–∞','–í—ã–∫—Ä–∏–∫–Ω–∏ –≤ –æ–∫–Ω–æ','–ò–∑–æ–±—Ä–∞–∑–∏ –∑–Ω–∞–º–µ–Ω–∏—Ç–æ—Å—Ç—å'];
const t18=['–ü–∏–∫–∞–Ω—Ç–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è','–ü–æ—Ü–µ–ª—É–π –∫—É–¥–∞ —Å–∫–∞–∂—É—Ç','–°—Ç—Ä–∏–ø—Ç–∏–∑ 30 —Å–µ–∫','2 —à–æ—Ç–∞','–†–∞—Å—Å–∫–∞–∂–∏ —Ñ–∞–Ω—Ç–∞–∑–∏—é','–ú–∞—Å—Å–∞–∂','–í—ã–ø–æ–ª–Ω–∏ –∂–µ–ª–∞–Ω–∏–µ','–°–Ω–∏–º–∏ —á—Ç–æ-—Ç–æ','–ì–æ—Ä—è—á–∏–π –æ–ø—ã—Ç','–°—Ç—Ä–∞—Å—Ç–Ω—ã–π –ø–æ—Ü–µ–ª—É–π'];
const render=()=>{
const tasks=age==='18+'?t18:t16;
c.innerHTML=`
<div style="text-align:center;margin-bottom:24px">
<div style="display:inline-flex;gap:12px">
<button class="btn ${age==='16+'?'':'btn-secondary'}" onclick="setBottleAge('16+')">16+</button>
<button class="btn ${age==='18+'?'':'btn-secondary'}" onclick="setBottleAge('18+')">18+</button>
</div>
</div>
<div style="position:relative;width:200px;height:200px;margin:40px auto">
<svg id="bottle" viewBox="0 0 100 100" style="width:100%;height:100%;cursor:pointer;transition:transform 3s cubic-bezier(.25,.46,.45,.94)">
<rect x="44" y="15" width="12" height="25" fill="url(#bG)" rx="2"/>
<ellipse cx="50" cy="40" rx="18" ry="22" fill="url(#bG)" opacity=".9"/>
<ellipse cx="50" cy="62" rx="14" ry="20" fill="url(#bG)" opacity=".8"/>
<circle cx="50" cy="18" r="5" fill="#ec4899"/>
<defs>
<linearGradient id="bG" x1="0%" y1="0%" x2="100%" y2="100%">
<stop offset="0%" style="stop-color:#6366f1"/>
<stop offset="100%" style="stop-color:#ec4899"/>
</linearGradient>
</defs>
</svg>
</div>
<div style="text-align:center">
<button class="btn" onclick="spinBottle()" ${spin?'disabled':''}>üîÑ –ö—Ä—É—Ç–∏—Ç—å</button>
</div>
<div id="bottleTask" style="margin-top:24px"></div>
`;
};
window.setBottleAge=a=>{age=a;render()};
window.spinBottle=()=>{
if(spin)return;
spin=1;
const b=$('bottle');
const deg=1800+Math.random()*360;
b.style.transform=`rotate(${deg}deg)`;
playSound('spin');
setTimeout(()=>{
const tasks=age==='18+'?t18:t16;
const task=tasks[Math.floor(Math.random()*tasks.length)];
$('bottleTask').innerHTML=`<div style="padding:20px;background:rgba(99,102,241,.1);border-radius:12px;border:1px solid var(--accent)">
<p style="font-size:18px;font-weight:600;text-align:center">${task}</p></div>`;
spin=0;
playSound('task');
if(state.settings.vib&&tg&&tg.HapticFeedback)tg.HapticFeedback.impactOccurred('medium');
},3000);
};
render();
}

function initTruth(c){
let age='16+';
const tr16=['–ß—Ç–æ –≥—É–≥–ª–∏–ª —Å—Ç—Ä–∞–Ω–Ω–æ–≥–æ?','–ö–æ–≥–æ –ø–æ—Ü–µ–ª–æ–≤–∞–ª –±—ã?','–ù–µ–ª–æ–≤–∫–æ–µ —Å–≤–∏–¥–∞–Ω–∏–µ?','–ó–∞ –∫–µ–º —Å–ª–µ–¥–∏—à—å —Ç–∞–π–Ω–æ?','–õ–æ–∂—å —Ä–æ–¥–∏—Ç–µ–ª—è–º?','–ë–µ–∑—É–º–∏–µ –≤ —à–∫–æ–ª–µ?','–°—Ç—Ä–∞–Ω–Ω—ã–π —Å–æ–Ω?','–ü–µ—Ä–≤–∞—è –ª—é–±–æ–≤—å?','–°—Ç—ã–¥–Ω—ã–π –º–æ–º–µ–Ω—Ç?','–ß—Ç–æ —Å–∫—Ä—ã–≤–∞–µ—à—å?','–°—Ç—Ä–∞—à–Ω–æ–µ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ?','–ö—Ç–æ –Ω—Ä–∞–≤–∏—Ç—Å—è?'];
const tr18=['–ì–æ—Ä—è—á–µ–µ –º–µ—Å—Ç–æ —Å–µ–∫—Å–∞?','–° –∫–µ–º –∏–∑ –¥—Ä—É–∑–µ–π?','–ë–µ–∑—É–º–Ω–∞—è —Ñ–∞–Ω—Ç–∞–∑–∏—è?','–°–µ–∫—Å —Å –Ω–µ–∑–Ω–∞–∫–æ–º—Ü–µ–º?','–°—Ç—Ä–∞–Ω–Ω—ã–π –æ–ø—ã—Ç?','–†–∏—Å–∫–æ–≤–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ?','–°—Ç—Ä–∞—Å—Ç–Ω—ã–π –ø–æ—Ü–µ–ª—É–π?','–°–∫–æ–ª—å–∫–æ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤?','–ü–∏–∫–∞–Ω—Ç–Ω–æ–µ –∂–µ–ª–∞–Ω–∏–µ?','–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã?'];
const da16=['–ü–æ—Ü–µ–ª—É–π –≤ —â—ë–∫—É','–°–º—Å –±—ã–≤—à–µ–º—É','–¢–∞–Ω—Ü—É–π 2 –º–∏–Ω','–ú–∞—Å—Å–∞–∂ —Å–æ—Å–µ–¥—É','–í—ã–ø–µ–π –∑–∞–ª–ø–æ–º','–ü—Ä–∏–∑–Ω–∞–π—Å—è –∫—Ç–æ –Ω—Ä–∞–≤–∏—Ç—Å—è','–ò–∑–æ–±—Ä–∞–∑–∏ –ø—å—è–Ω–æ–≥–æ','–û–±–Ω–∏–º–∏—Å—å','–°–µ–ª—Ñ–∏ —Å–æ –≤—Å–µ–º–∏','–ö–æ–º–ø–ª–∏–º–µ–Ω—Ç –∫–∞–∂–¥–æ–º—É'];
const da18=['–°—Ç—Ä–∞—Å—Ç–Ω—ã–π –ø–æ—Ü–µ–ª—É–π','–õ—ç–ø–¥–∞–Ω—Å','–≠—Ä–æ—Ç–∏—á–Ω—ã–π –º–∞—Å—Å–∞–∂','–°–Ω–∏–º–∞–π –æ–¥–µ–∂–¥—É','–° –∫–µ–º –ø–µ—Ä–µ—Å–ø–∞—Ç—å','–ü–æ—Ü–µ–ª—É–π —à–µ—é','–ë—É—Ç—ã–ª–æ—á–∫–∞ —Ä–∞–∑–¥–µ–≤–∞–Ω–∏–µ','–ü—Ä–∏–∑–Ω–∞–Ω–∏–µ —Ñ–∞–Ω—Ç–∞–∑–∏–∏','–ü–æ–∫–∞–∂–∏ –∏–Ω—Ç–∏–º–Ω–æ–µ','–ì–æ—Ä—è—á–∞—è –∏—Å—Ç–æ—Ä–∏—è'];
const render=()=>{
c.innerHTML=`
<div style="text-align:center;margin-bottom:24px">
<div style="display:inline-flex;gap:12px">
<button class="btn ${age==='16+'?'':'btn-secondary'}" onclick="setTDAge('16+')">16+</button>
<button class="btn ${age==='18+'?'':'btn-secondary'}" onclick="setTDAge('18+')">18+</button>
</div>
</div>
<div style="display:flex;gap:12px">
<button class="btn" style="flex:1" onclick="getTruth()">ü§î –ü—Ä–∞–≤–¥–∞</button>
<button class="btn" style="flex:1" onclick="getDare()">üéØ –î–µ–π—Å—Ç–≤–∏–µ</button>
</div>
<div id="tdResult" style="margin-top:24px"></div>
`;
};
window.setTDAge=a=>{age=a;render()};
window.getTruth=()=>{
const t=age==='18+'?tr18:tr16;
const q=t[Math.floor(Math.random()*t.length)];
$('tdResult').innerHTML=`<div style="padding:20px;background:rgba(99,102,241,.1);border-radius:12px;border:1px solid var(--accent)">
<p style="font-size:18px;font-weight:600;text-align:center">‚ùì ${q}</p></div>`;
playSound('task');
};
window.getDare=()=>{
const d=age==='18+'?da18:da16;
const a=d[Math.floor(Math.random()*d.length)];
$('tdResult').innerHTML=`<div style="padding:20px;background:rgba(99,102,241,.1);border-radius:12px;border:1px solid var(--accent)">
<p style="font-size:18px;font-weight:600;text-align:center">‚ö° ${a}</p></div>`;
playSound('task');
};
render();
}

function initSeven(c){
let mode='local',deck=36,pCount=4,players=[],cards=[],discard=[],current=null,started=0,curIdx=0;
const effects={
'A':{n:'–í—Å–µ –ø—å—é—Ç',i:'üç∫',a:'–í—Å–µ –¥–µ–ª–∞—é—Ç –≥–ª–æ—Ç–æ–∫',c:'#ef4444'},
'2':{n:'–°–ª–µ–≤–∞',i:'üëà',a:'–ò–≥—Ä–æ–∫ —Å–ª–µ–≤–∞ –ø—å—ë—Ç',c:'#3b82f6'},
'3':{n:'–°–∞–º',i:'ü•É',a:'–¢—è–Ω—É–≤—à–∏–π –ø—å—ë—Ç',c:'#f59e0b'},
'4':{n:'–¢—Ä–∏',i:'üçª',a:'–¢—ã+–¥–≤–∞ –ø–æ –±–æ–∫–∞–º',c:'#10b981'},
'5':{n:'–Ø –Ω–∏–∫–æ–≥–¥–∞',i:'üôä',a:'–ö—Ç–æ –¥–µ–ª–∞–ª-–ø—å—ë—Ç',c:'#8b5cf6'},
'6':{n:'–í—ã–±–µ—Ä–∏',i:'üëâ',a:'–ö—Ç–æ –ø—å—ë—Ç –≤–º–µ—Å—Ç–æ',c:'#ec4899'},
'7':{n:'–ó–∞–¥–∞–Ω–∏–µ',i:'üìù',a:'–ü—Ä–∏–¥—É–º–∞–π –∑–∞–¥–∞–Ω–∏–µ',c:'#06b6d4'},
'8':{n:'–í—ã—Ö–æ–¥',i:'üö™',a:'–í—ã—Ö–æ–¥ 3 –º–∏–Ω',c:'#6366f1'},
'9':{n:'–ï—â—ë',i:'‚ûï',a:'–¢—è–Ω–∏ –µ—â—ë',c:'#84cc16'},
'10':{n:'–¢–µ–º–∞',i:'üí≠',a:'–ü—Ä–∏–¥—É–º–∞–π —Ç–µ–º—É',c:'#f97316'},
'J':{n:'–†—É–∫–∏',i:'üëã',a:'–†—É–∫–∏ –Ω–∞ —Å—Ç–æ–ª',c:'#14b8a6'},
'Q':{n:'–í–æ–ø—Ä–æ—Å—ã',i:'‚ùì',a:'–ó–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å—ã',c:'#a855f7'},
'K':{n:'–ö–æ—Ä–æ–ª—å',i:'üëë',a:'–ö—Ç–æ –∏ —Å–∫–æ–ª—å–∫–æ',c:'#eab308'}
};
const suits=['‚ô†Ô∏è','‚ô•Ô∏è','‚ô£Ô∏è','‚ô¶Ô∏è'];
const render=()=>{
if(!started){
c.innerHTML=`
<div class="settings-section">
<label style="font-weight:600;margin-bottom:12px;display:block">–†–µ–∂–∏–º</label>
<div style="display:inline-flex;gap:12px">
<button class="btn ${mode==='local'?'':'btn-secondary'}" onclick="setSevenMode('local')">üè† –õ–æ–∫–∞–ª—å–Ω–æ</button>
<button class="btn ${mode==='online'?'':'btn-secondary'}" onclick="setSevenMode('online')">üåê –û–Ω–ª–∞–π–Ω</button>
</div>
</div>
<div class="settings-section">
<label style="font-weight:600;margin-bottom:12px;display:block">–ö–æ–ª–æ–¥–∞</label>
<div style="display:inline-flex;gap:12px">
<button class="btn ${deck===36?'':'btn-secondary'}" onclick="setDeck(36)">36 –∫–∞—Ä—Ç</button>
<button class="btn ${deck===52?'':'btn-secondary'}" onclick="setDeck(52)">52 –∫–∞—Ä—Ç—ã</button>
</div>
</div>
<div class="settings-section">
<label style="font-weight:600;margin-bottom:12px;display:block">–ò–≥—Ä–æ–∫–∏ (3-8)</label>
<div style="display:flex;gap:8px;flex-wrap:wrap">
${[3,4,5,6,7,8].map(n=>`<button class="btn ${pCount===n?'':'btn-secondary'}" onclick="setPlayers(${n})">${n}</button>`).join('')}
</div>
</div>
<button class="btn" style="width:100%;margin-top:20px;font-size:18px;padding:18px" onclick="startSeven()">üé¥ –ù–∞—á–∞—Ç—å</button>
`;
}else{
const p=players[curIdx];
const info=current?effects[current.rank]:null;
c.innerHTML=`
<div style="text-align:center;padding:15px;background:rgba(255,255,255,.03);border-radius:12px;margin-bottom:20px;font-weight:600">
üéÆ –ò–≥—Ä–æ–∫–æ–≤: ${players.length} | üé¥ –ö–∞—Ä—Ç: ${cards.length} | üóëÔ∏è –°–±—Ä–æ—Å: ${discard.length}
</div>
<div class="players-list">
${players.map((pl,i)=>`<div class="player-chip ${i===curIdx?'active':''}">${i===curIdx?'üëâ ':''}${pl}</div>`).join('')}
</div>
<div class="cards-deck">
${current?`
<div class="card" style="border-color:${info.c};box-shadow:0 0 40px ${info.c}40">
<div class="card-rank">${current.rank}</div>
<div class="card-suit">${current.suit}</div>
<div class="card-effect">${info.n}</div>
</div>
`:'<div style="text-align:center;padding:40px"><p style="font-size:48px;margin-bottom:20px">üé¥</p><p style="color:var(--dim)">–ù–∞–∂–º–∏ "–í–∑—è—Ç—å –∫–∞—Ä—Ç—É"</p></div>'}
</div>
${current&&info?`<div style="margin-top:20px;padding:20px;background:${info.c}15;border:1px solid ${info.c};border-radius:16px">
<div style="font-size:20px;font-weight:700;margin-bottom:10px;color:${info.c}">${info.i} ${info.n}</div>
<div style="font-size:15px;line-height:1.6">${info.a}</div>
</div>`:''}
<div style="display:flex;gap:10px;margin-top:20px">
<button class="btn" style="flex:1" onclick="drawCard()">üé¥ –í–∑—è—Ç—å</button>
<button class="btn btn-secondary" onclick="resetSeven()">üîÑ –ù–æ–≤–∞—è</button>
</div>
`;
}
};
window.setSevenMode=m=>{mode=m;render()};
window.setDeck=d=>{deck=d;render()};
window.setPlayers=p=>{pCount=p;render()};
window.startSeven=()=>{
started=1;
players=[state.user.username];
for(let i=1;i<pCount;i++)players.push(getRndBot());
cards=[];
const ranks=deck===36?['6','7','8','9','10','J','Q','K','A']:['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
suits.forEach(s=>ranks.forEach(r=>cards.push({rank:r,suit:s})));
for(let i=cards.length-1;i>0;i--){
const j=Math.floor(Math.random()*(i+1));
[cards[i],cards[j]]=[cards[j],cards[i]];
}
discard=[];
curIdx=0;
render();
toast('üé¥ –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å','success');
};
window.drawCard=()=>{
if(cards.length===0){
if(discard.length>0){
cards=[...discard];
discard=[];
for(let i=cards.length-1;i>0;i--){
const j=Math.floor(Math.random()*(i+1));
[cards[i],cards[j]]=[cards[j],cards[i]];
}
toast('‚ôªÔ∏è –ü–µ—Ä–µ–º–µ—à–∞–ª–∏ —Å–±—Ä–æ—Å','success');
}else{
toast('üé¥ –ö–æ–ª–æ–¥–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å','warning');
return;
}
}
const card=cards.pop();
if(current)discard.push(current);
current=card;
const info=effects[card.rank];
addHistory(`–°–µ–º—ë—Ä–æ—á–∫–∞ - ${card.rank}${card.suit}`);
render();
setTimeout(()=>{
if(card.rank!=='9'){
curIdx=(curIdx+1)%players.length;
render();
}else{
toast('‚ûï –¢—è–Ω–∏ –µ—â—ë','success');
}
},3000);
playSound('task');
};
window.resetSeven=()=>{
if(confirm('–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É?')){
started=0;
current=null;
render();
}
};
render();
}

function initTTT(c){
let board=Array(9).fill(''),cur='X',active=1;
const render=()=>{
c.innerHTML=`
<div class="ttt-board">
${board.map((cell,i)=>`<div class="ttt-cell ${cell?'filled '+cell.toLowerCase():''}" data-idx="${i}">${cell}</div>`).join('')}
</div>
<div style="text-align:center;margin-top:20px">
<p style="font-size:18px;margin-bottom:15px">–•–æ–¥: <strong style="color:${cur==='X'?'#ef4444':'#3b82f6'}">${cur}</strong></p>
<button class="btn" onclick="resetTTT()">üîÑ –ù–æ–≤–∞—è</button>
</div>
`;
$$('.ttt-cell').forEach(cell=>{
cell.addEventListener('click',()=>{
const i=parseInt(cell.dataset.idx);
if(!active||board[i])return;
board[i]=cur;
cell.textContent=cur;
cell.classList.add('filled',cur.toLowerCase());
if(checkWin()){
setTimeout(()=>{
toast(`${cur} –ø–æ–±–µ–¥–∏–ª! üéâ`,'success');
active=0;
},300);
return;
}
if(board.every(c=>c)){
setTimeout(()=>{
toast('–ù–∏—á—å—è! ü§ù','success');
active=0;
},300);
return;
}
cur=cur==='X'?'O':'X';
render();
});
});
};
const checkWin=()=>{
const w=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
return w.some(combo=>board[combo[0]]&&board[combo[0]]===board[combo[1]]&&board[combo[1]]===board[combo[2]]);
};
window.resetTTT=()=>{
board=Array(9).fill('');
cur='X';
active=1;
render();
};
render();
}

function initDare(c){
const q=['–ü–∏–ª –∞–ª–∫–æ–≥–æ–ª—å –≤ —à–∫–æ–ª–µ','–í—Ä–∞–ª —Ä–æ–¥–∏—Ç–µ–ª—è–º','–ö—Ä–∞–ª —á—Ç–æ-—Ç–æ','–¶–µ–ª–æ–≤–∞–ª—Å—è –Ω–∞ –ø–µ—Ä–≤–æ–º —Å–≤–∏–¥–∞–Ω–∏–∏','–£–±–µ–≥–∞–ª –æ—Ç –ø–æ–ª–∏—Ü–∏–∏','–ö—É—Ä–∏–ª —á—Ç–æ-—Ç–æ','–°–º–æ—Ç—Ä–µ–ª 18+','–ü—Ä–∏–∑–Ω–∞–≤–∞–ª—Å—è –≤ –ª—é–±–≤–∏ –ø—å—è–Ω—ã–º','–î—Ä–∞–ª—Å—è','–û–±–º–∞–Ω—ã–≤–∞–ª –¥—Ä—É–∑–µ–π'];
c.innerHTML=`
<div style="text-align:center;margin-bottom:24px">
<p style="font-size:18px;font-weight:600;margin-bottom:20px">–ü—Ä–∞–≤–∏–ª–∞:</p>
<p style="color:var(--dim);line-height:1.6">–í–µ–¥—É—â–∏–π –≥–æ–≤–æ—Ä–∏—Ç "–Ø –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ...", –∫—Ç–æ –¥–µ–ª–∞–ª - –ø—å—ë—Ç</p>
</div>
<div style="text-align:center">
<button class="btn" onclick="getDareQ()">üé≤ –°–ª—É—á–∞–π–Ω–æ–µ</button>
</div>
<div id="dareQ" style="margin-top:24px"></div>
`;
window.getDareQ=()=>{
const question=q[Math.floor(Math.random()*q.length)];
$('dareQ').innerHTML=`<div style="padding:20px;background:rgba(99,102,241,.1);border-radius:12px;border:1px solid var(--accent)">
<p style="font-size:18px;font-weight:600;text-align:center">–Ø –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ ${question}</p></div>`;
playSound('task');
};
}

function initMafia(c){
c.innerHTML=`
<div style="text-align:center;padding:40px">
<p style="font-size:48px;margin-bottom:20px">üïµÔ∏è</p>
<p style="font-size:20px;font-weight:600;margin-bottom:16px">–ú–∞—Ñ–∏—è</p>
<p style="color:var(--dim);line-height:1.6;max-width:400px;margin:0 auto">
–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∏–≥—Ä–∞ –≤ –º–∞—Ñ–∏—é. –í–µ–¥—É—â–∏–π —Ä–∞–∑–¥–∞—ë—Ç —Ä–æ–ª–∏, –≥–æ—Ä–æ–¥ –∑–∞—Å—ã–ø–∞–µ—Ç, –º–∞—Ñ–∏—è –≤—ã–±–∏—Ä–∞–µ—Ç –∂–µ—Ä—Ç–≤—É, –≥–æ—Ä–æ–¥ –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è –∏ –≥–æ–ª–æ—Å—É–µ—Ç.
</p>
<button class="btn" style="margin-top:24px" onclick="toast('–†–∞–∑–¥–∞–π—Ç–µ —Ä–æ–ª–∏ –∏ –Ω–∞—á–∏–Ω–∞–π—Ç–µ!','success')">üé≠ –ù–∞—á–∞—Ç—å –ø–∞—Ä—Ç–∏—é</button>
</div>
`;
}

function initAlias(c){
const words=['—Å—Ç–æ–ª','—Å–æ–±–∞–∫–∞','–æ–±–ª–∞–∫–æ','–∫–æ–º–ø—å—é—Ç–µ—Ä','–∫–Ω–∏–≥–∞','—Ç–µ–ª–µ—Ñ–æ–Ω','–º–∞—à–∏–Ω–∞','–¥–µ—Ä–µ–≤–æ','—Ü–≤–µ—Ç–æ–∫','–º—É–∑—ã–∫–∞','—Ç–∞–Ω–µ—Ü','—Å–ø–æ—Ä—Ç','–∫–∏–Ω–æ','–º–æ—Ä–µ','–≥–æ—Ä—ã','–≥–æ—Ä–æ–¥','–¥–µ—Ä–µ–≤–Ω—è','–¥–æ–º','—à–∫–æ–ª–∞','—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç'];
c.innerHTML=`
<div style="text-align:center;margin-bottom:24px">
<p style="font-size:18px;font-weight:600;margin-bottom:20px">–û–±—ä—è—Å–Ω–∏ —Å–ª–æ–≤–æ –∑–∞ 60 —Å–µ–∫—É–Ω–¥</p>
</div>
<div style="text-align:center">
<button class="btn" onclick="getAliasWord()">üé≤ –°–ª—É—á–∞–π–Ω–æ–µ —Å–ª–æ–≤–æ</button>
</div>
<div id="aliasWord" style="margin-top:24px"></div>
`;
window.getAliasWord=()=>{
const w=words[Math.floor(Math.random()*words.length)];
$('aliasWord').innerHTML=`<div style="padding:30px;background:rgba(99,102,241,.1);border-radius:12px;border:1px solid var(--accent)">
<p style="font-size:32px;font-weight:800;text-align:center;text-transform:uppercase">${w}</p></div>`;
playSound('task');
};
}

function initCroc(c){
const words=['–∫–æ—Ç','—Ç–∞–Ω–∫','—Å–∞–º–æ–ª—ë—Ç','–¥–æ–∂–¥—å','–∑–æ–Ω—Ç','—à–∞—Ä—Ñ','–æ—á–∫–∏','—Ç–µ–ª–µ–≤–∏–∑–æ—Ä','—Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫','–≤–µ–ª–æ—Å–∏–ø–µ–¥'];
c.innerHTML=`
<div style="text-align:center;margin-bottom:24px">
<p style="font-size:18px;font-weight:600;margin-bottom:20px">–ü–æ–∫–∞–∂–∏ —Å–ª–æ–≤–æ –∂–µ—Å—Ç–∞–º–∏</p>
</div>
<div style="text-align:center">
<button class="btn" onclick="getCrocWord()">üé≤ –°–ª—É—á–∞–π–Ω–æ–µ —Å–ª–æ–≤–æ</button>
</div>
<div id="crocWord" style="margin-top:24px"></div>
`;
window.getCrocWord=()=>{
const w=words[Math.floor(Math.random()*words.length)];
$('crocWord').innerHTML=`<div style="padding:30px;background:rgba(99,102,241,.1);border-radius:12px;border:1px solid var(--accent)">
<p style="font-size:32px;font-weight:800;text-align:center;text-transform:uppercase">${w}</p></div>`;
playSound('task');
};
}

function initCities(c){
let last='';
c.innerHTML=`
<div style="text-align:center;margin-bottom:24px">
<p style="font-size:18px;font-weight:600;margin-bottom:20px">–ì–æ—Ä–æ–¥–∞</p>
<p style="color:var(--dim);line-height:1.6">–ù–∞–∑—ã–≤–∞–π—Ç–µ –≥–æ—Ä–æ–¥–∞ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –±—É–∫–≤—É –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ</p>
</div>
<div style="text-align:center">
<input type="text" id="cityInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥" style="padding:14px;background:rgba(255,255,255,.05);border:1px solid var(--border);border-radius:12px;color:var(--text);font-size:16px;width:100%;max-width:300px;margin-bottom:12px">
<button class="btn" onclick="addCity()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
</div>
<div id="citiesList" style="margin-top:24px"></div>
`;
window.addCity=()=>{
const inp=$('cityInput');
const city=inp.value.trim();
if(!city)return;
if(last&&city.charAt(0).toLowerCase()!==last){
toast('–ù–µ–≤–µ—Ä–Ω–∞—è –±—É–∫–≤–∞!','error');
return;
}
last=city.charAt(city.length-1).toLowerCase();
const list=$('citiesList');
const item=document.createElement('div');
item.style.cssText='padding:12px;background:rgba(99,102,241,.1);border-radius:8px;margin-bottom:8px;text-align:center;font-weight:600';
item.textContent=city;
list.insertBefore(item,list.firstChild);
inp.value='';
playSound('task');
};
}

function initAssoc(c){
const words=['–ª—é–±–æ–≤—å','—Å–≤–æ–±–æ–¥–∞','–º–µ—á—Ç–∞','—Å—á–∞—Å—Ç—å–µ','–¥—Ä—É–∂–±–∞','—Ä–∞–¥–æ—Å—Ç—å','–Ω–∞–¥–µ–∂–¥–∞','—É—Å–ø–µ—Ö','–∫—Ä–∞—Å–æ—Ç–∞','—Å–∏–ª–∞'];
c.innerHTML=`
<div style="text-align:center;margin-bottom:24px">
<p style="font-size:18px;font-weight:600;margin-bottom:20px">–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏</p>
<p style="color:var(--dim);line-height:1.6">–ù–∞–∑–æ–≤–∏—Ç–µ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏—é –Ω–∞ —Å–ª–æ–≤–æ</p>
</div>
<div style="text-align:center">
<button class="btn" onclick="getAssocWord()">üé≤ –°–ª—É—á–∞–π–Ω–æ–µ —Å–ª–æ–≤–æ</button>
</div>
<div id="assocWord" style="margin-top:24px"></div>
`;
window.getAssocWord=()=>{
const w=words[Math.floor(Math.random()*words.length)];
$('assocWord').innerHTML=`<div style="padding:30px;background:rgba(99,102,241,.1);border-radius:12px;border:1px solid var(--accent)">
<p style="font-size:32px;font-weight:800;text-align:center;text-transform:uppercase">${w}</p></div>`;
playSound('task');
};
}

let chatMsgs=[];
function loadChat(){
const s=localStorage.getItem('chat');
if(s){
chatMsgs=JSON.parse(s);
}else{
chatMsgs=[
{user:'–°–∏—Å—Ç–µ–º–∞',text:'–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! üéâ',time:getTime(),del:0},
{user:getRndBot(),text:'–ü—Ä–∏–≤–µ—Ç –≤—Å–µ–º!',time:getTime(),del:0}
];
}
renderChat();
}

function renderChat(){
const c=$('chatMessages');
c.innerHTML=chatMsgs.map(m=>`
<div class="chat-message">
<div class="chat-avatar">${m.user.charAt(0).toUpperCase()}</div>
<div class="chat-content">
<div class="chat-header">
<span class="chat-username">${m.user}</span>
<span class="chat-time">${m.time}</span>
</div>
<div class="chat-text ${m.del?'deleted':''}">${m.text}</div>
</div>
</div>
`).join('');
c.scrollTop=c.scrollHeight;
}

function sendMessage(){
const inp=$('chatInput');
const txt=inp.value.trim();
if(!txt)return;
const banned=['vk.com','vk.me','tg.me','t.me'];
const hasLink=banned.some(d=>txt.toLowerCase().includes(d));
const msg={user:state.user.username,text:hasLink?'–°–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ —Å–∏—Å—Ç–µ–º–æ–π':txt,time:getTime(),del:hasLink};
chatMsgs.push(msg);
saveChat();
renderChat();
inp.value='';
playSound('send');
if(hasLink){
toast('‚ö†Ô∏è –°—Å—ã–ª–∫–∞ —É–¥–∞–ª–µ–Ω–∞','error');
}
if(!hasLink&&Math.random()>.7){
setTimeout(()=>{
const resp=['–°–æ–≥–ª–∞—Å–µ–Ω!','–ö—Ä—É—Ç–æ!','–ì–æ –∏–≥—Ä–∞—Ç—å!','üî•','üëç','–î–∞–≤–∞–π—Ç–µ!'];
chatMsgs.push({user:getRndBot(),text:resp[Math.floor(Math.random()*resp.length)],time:getTime(),del:0});
saveChat();
renderChat();
},1000+Math.random()*2000);
}
}

function saveChat(){
localStorage.setItem('chat',JSON.stringify(chatMsgs.slice(-100)));
}

let hist=[];
function loadHistory(){
const s=localStorage.getItem('hist');
if(s)hist=JSON.parse(s);
renderHistory();
}

function renderHistory(){
const c=$('historyList');
if(hist.length===0){
c.innerHTML='<p style="text-align:center;padding:40px;color:var(--dim)">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</p>';
return;
}
c.innerHTML=hist.slice(0,50).map(e=>`
<div class="history-item">
<div class="history-info">
<div class="history-user">${e.user}</div>
<div class="history-game">${e.game}</div>
</div>
<div class="history-time">${e.time}</div>
</div>
`).join('');
}

function addHistory(game){
hist.unshift({user:state.user.username,game:game,time:new Date().toLocaleString('ru-RU')});
saveHist();
}

function saveHist(){
localStorage.setItem('hist',JSON.stringify(hist.slice(0,100)));
}

function clearHistory(){
if(confirm('–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é?')){
hist=[];
saveHist();
renderHistory();
toast('üóëÔ∏è –ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞','success');
}
}

function exportHistory(){
const data=JSON.stringify(hist,null,2);
const blob=new Blob([data],{type:'application/json'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');
a.href=url;
a.download=`history-${Date.now()}.json`;
a.click();
toast('üì• –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ','success');
}

function toggleBots(){
state.bots=$('botsToggle').checked;
if(state.bots){
startBots();
toast('ü§ñ –ë–æ—Ç—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã','success');
}else{
stopBots();
toast('ü§ñ –ë–æ—Ç—ã –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã','success');
}
}

function startBots(){
if(state.botInt)return;
state.botInt=setInterval(()=>{
const bot=getRndBot();
const game=GAMES[Math.floor(Math.random()*GAMES.length)];
const results=['–≤—ã–∏–≥—Ä–∞–ª','–ø—Ä–æ–∏–≥—Ä–∞–ª','—Å—ã–≥—Ä–∞–ª','–ø—Ä–æ—à—ë–ª'];
const res=results[Math.floor(Math.random()*results.length)];
hist.unshift({user:bot,game:`${game.name} - ${res}`,time:new Date().toLocaleString('ru-RU')});
saveHist();
if(!$('historySection').classList.contains('hidden')){
renderHistory();
}
},3000+Math.random()*5000);
}

function stopBots(){
if(state.botInt){
clearInterval(state.botInt);
state.botInt=null;
}
}

function updateAdmin(){
$('adminOnline').textContent=Math.floor(Math.random()*15)+5;
$('adminMessages').textContent=chatMsgs.length;
$('adminGames').textContent=hist.length;
}

function clearAllData(){
if(confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?')){
chatMsgs=[];
hist=[];
localStorage.clear();
saveChat();
saveHist();
renderChat();
renderHistory();
toast('üóëÔ∏è –í—Å—ë —É–¥–∞–ª–µ–Ω–æ','success');
}
}

function exportAllData(){
const data={chat:chatMsgs,hist:hist,user:state.user,exported:new Date().toISOString()};
const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');
a.href=url;
a.download=`data-${Date.now()}.json`;
a.click();
toast('üíæ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ','success');
}

function loadSettings(){
const s=localStorage.getItem('settings');
if(s){
state.settings=JSON.parse(s);
$('soundToggle').checked=state.settings.sound;
$('vibrationToggle').checked=state.settings.vib;
setTheme(state.settings.theme,1);
}
}

function saveSettings(){
localStorage.setItem('settings',JSON.stringify(state.settings));
}

function toggleSound(){
state.settings.sound=$('soundToggle').checked;
saveSettings();
toast(state.settings.sound?'üîä –ó–≤—É–∫ –≤–∫–ª':'üîá –ó–≤—É–∫ –≤—ã–∫–ª','success');
}

function toggleVibration(){
state.settings.vib=$('vibrationToggle').checked;
saveSettings();
toast(state.settings.vib?'üì≥ –í–∏–±—Ä–∞—Ü–∏—è –≤–∫–ª':'üì¥ –í–∏–±—Ä–∞—Ü–∏—è –≤—ã–∫–ª','success');
}

function setTheme(t,silent){
state.settings.theme=t;
document.body.className=t==='default'?'':'theme-'+t;
$$('.theme-btn').forEach(b=>b.classList.remove('active'));
const themes={default:0,purple:1,blue:2,green:3,red:4};
$$('.theme-btn')[themes[t]||0].classList.add('active');
saveSettings();
if(!silent)toast('üé® –¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞','success');
}

const audioCtx=new(window.AudioContext||window.webkitAudioContext)();
function playSound(type){
if(!state.settings.sound)return;
const osc=audioCtx.createOscillator();
const gain=audioCtx.createGain();
osc.connect(gain);
gain.connect(audioCtx.destination);
const sounds={
login:[800,.3],click:[600,.1],open:[500,.2],close:[400,.2],
spin:[300,.5],task:[700,.4],send:[650,.15]
};
const[freq,dur]=sounds[type]||[500,.2];
osc.frequency.value=freq;
gain.gain.setValueAtTime(.3,audioCtx.currentTime);
gain.gain.exponentialRampToValueAtTime(.01,audioCtx.currentTime+dur);
osc.start(audioCtx.currentTime);
osc.stop(audioCtx.currentTime+dur);
}

function toast(msg,type='success'){
const c=$('toastContainer');
const t=document.createElement('div');
t.className=`toast ${type}`;
const icons={success:'‚úÖ',error:'‚ùå',warning:'‚ö†Ô∏è'};
t.innerHTML=`
<span class="toast-icon">${icons[type]||'‚ÑπÔ∏è'}</span>
<span class="toast-text">${msg}</span>
`;
c.appendChild(t);
setTimeout(()=>{
t.style.animation='slideOutRight .3s ease';
setTimeout(()=>t.remove(),300);
},3000);
}

function getRndBot(){
return BOTS[Math.floor(Math.random()*BOTS.length)];
}

function getTime(){
return new Date().toLocaleTimeString('ru-RU',{hour:'2-digit',minute:'2-digit'});
}

function $(id){return document.getElementById(id)}
function $$(sel){return document.querySelectorAll(sel)}

window.addEventListener('DOMContentLoaded',()=>{
const savedUser=localStorage.getItem('user');
if(savedUser){
auth(JSON.parse(savedUser));
}
const inp=$('chatInput');
if(inp){
inp.addEventListener('keypress',e=>{
if(e.key==='Enter')sendMessage();
});
}
});
</script>

</body>
</html>